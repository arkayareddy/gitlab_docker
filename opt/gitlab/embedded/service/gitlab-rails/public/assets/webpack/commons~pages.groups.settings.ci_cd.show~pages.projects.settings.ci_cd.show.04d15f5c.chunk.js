(this.webpackJsonp=this.webpackJsonp||[]).push([[66],{"++os":function(e,t,n){"use strict";var r=n("ZfjD"),i=n("PpKG"),a=n("sieV");r({target:"WeakMap",proto:!0,real:!0,forced:i},{deleteAll:function(){return a.apply(this,arguments)}})},"2Dmn":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("+kFb"),n("Id6h");var r=n("/lV4"),i=n("NmEs");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){var n=t.container,r=t.valueSelector,i=void 0===r?".js-secret-value":r,a=t.placeholderSelector,o=void 0===a?".js-secret-value-placeholder":a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.valueSelector=i,this.placeholderSelector=o}var t,n,o;return t=e,(n=[{key:"init",value:function(){if(this.revealButton=this.container.querySelector(".js-secret-value-reveal-button"),this.revealButton){var e=Object(i.H)(this.revealButton.dataset.secretRevealStatus);this.updateDom(e),this.revealButton.addEventListener("click",this.onRevealButtonClicked.bind(this))}}},{key:"onRevealButtonClicked",value:function(){var e=Object(i.H)(this.revealButton.dataset.secretRevealStatus);this.updateDom(!e)}},{key:"updateDom",value:function(e){var t=this.container.querySelectorAll(this.valueSelector);t.forEach((function(t){t.classList.toggle("hide",!e)})),this.container.querySelectorAll(this.placeholderSelector).forEach((function(t){t.classList.toggle("hide",e)})),this.revealButton.textContent=e?Object(r.c)("Hide value","Hide values",t.length):Object(r.c)("Reveal value","Reveal values",t.length),this.revealButton.dataset.secretRevealStatus=e}}])&&a(t.prototype,n),o&&a(t,o),e}()},"5PBi":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("+kFb"),n("MRnW"),n("jaBk"),n("Id6h");var r=n("3a3M"),i=n.n(r),a=n("XRO8"),o=n("/lV4"),s=n("NmEs");function l(e,t){e.classList.toggle("is-checked",t)}function c(e,t,n){var r=Object(s.H)(t.value);l(e,!r),e.setAttribute("disabled",!0),e.classList.toggle("is-loading",!0),Promise.resolve(n(!r,e)).then((function(){t.setAttribute("value",!r)})).catch((function(){l(e,r)})).then((function(){e.removeAttribute("disabled"),e.classList.toggle("is-loading",!1),i()(t).trigger("trigger-change")})).catch((function(){Object(a.a)(Object(o.a)("Something went wrong when toggling the button"))}))}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.querySelectorAll(".js-project-feature-toggle").forEach((function(e){var n=e.querySelector(".js-project-feature-toggle-input");l(e,Object(s.H)(n.value)),e.addEventListener("click",c.bind(null,e,n,t))}))}},MKgV:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));n("va8A"),n("9U97"),n("kO4A"),n("+kFb"),n("gyUR"),n("Z5ek"),n("yaFd"),n("zCcL"),n("zpLX"),n("BD5p"),n("Id6h");var r=n("G3fq"),i=n.n(r),a=n("2ibD"),o=n("/lV4"),s=n("XRO8"),l=n("NmEs"),c=n("QwBj"),u=n("jKN4");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n=t.container,r=t.saveButton,i=t.errorBox,a=t.formField,o=void 0===a?"variables":a,s=t.saveEndpoint,l=t.maskableRegex;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.saveButton=r,this.errorBox=i,this.saveEndpoint=s,this.maskableRegex=l,this.variableList=new u.a({container:this.container,formField:o,maskableRegex:l}),this.bindEvents(),this.variableList.init()}var t,n,r;return t=e,(n=[{key:"bindEvents",value:function(){this.saveButton.addEventListener("click",this.onSaveClicked.bind(this))}},{key:"onSaveClicked",value:function(){var e=this,t=this.saveButton.querySelector(".js-ci-variables-save-loading-icon");return t.classList.toggle("hide",!1),this.errorBox.classList.toggle("hide",!0),this.variableList.toggleEnableRow(!1),a.a.patch(this.saveEndpoint,{variables_attributes:this.variableList.getAllData()},{validateStatus:function(e){return e>=c.a.OK&&e<c.a.MULTIPLE_CHOICES||e===c.a.BAD_REQUEST}}).then((function(n){var r,a;t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),n.status===c.a.OK&&n.data?(e.updateRowsWithPersistedVariables(n.data.variables),e.variableList.hideValues()):n.status===c.a.BAD_REQUEST&&(e.errorBox.innerHTML=(r=n.data,a=[].concat(r).map((function(e){return"\n    <li>\n      ".concat(i()(e),"\n    </li>\n  ")})),"\n    <p>\n      ".concat(Object(o.d)("CiVariable|Validation failed"),"\n    </p>\n    <ul>\n      ").concat(a.join(""),"\n    </ul>\n  ")),e.errorBox.classList.toggle("hide",!1))})).catch((function(){t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),Object(s.a)(Object(o.d)("CiVariable|Error occurred while saving variables"))}))}},{key:"updateRowsWithPersistedVariables",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[].concat(e).reduce((function(e,t){return f(f({},e),{},v({},t.key,t))}),{});this.container.querySelectorAll(".js-row").forEach((function(e){var n=e.querySelector(".js-ci-variable-input-destroy");if(Object(l.H)(n.value))e.remove();else{var r=e.querySelector(".js-ci-variable-input-key").value,i=t[r];i&&(e.querySelector(".js-ci-variable-input-id").value=i.id,e.setAttribute("data-is-persisted","true"))}}))}}])&&h(t.prototype,n),r&&h(t,r),e}()},QxQF:function(e,t,n){"use strict";var r=n("zaKd"),i=n("YO8x").getWeakData,a=n("70tN"),o=n("wZF9"),s=n("95WW"),l=n("H81m"),c=n("WG2a"),u=n("YEnO"),d=n("dPRI"),f=d.set,v=d.getterFor,h=c.find,p=c.findIndex,b=0,g=function(e){return e.frozen||(e.frozen=new w)},w=function(){this.entries=[]},m=function(e,t){return h(e.entries,(function(e){return e[0]===t}))};w.prototype={get:function(e){var t=m(this,e);if(t)return t[1]},has:function(e){return!!m(this,e)},set:function(e,t){var n=m(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=p(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,c){var d=e((function(e,r){s(e,d,t),f(e,{type:t,id:b++,frozen:void 0}),null!=r&&l(r,e[c],e,n)})),h=v(t),p=function(e,t,n){var r=h(e),o=i(a(t),!0);return!0===o?g(r).set(t,n):o[r.id]=n,e};return r(d.prototype,{delete:function(e){var t=h(this);if(!o(e))return!1;var n=i(e);return!0===n?g(t).delete(e):n&&u(n,t.id)&&delete n[t.id]},has:function(e){var t=h(this);if(!o(e))return!1;var n=i(e);return!0===n?g(t).has(e):n&&u(n,t.id)}}),r(d.prototype,n?{get:function(e){var t=h(this);if(o(e)){var n=i(e);return!0===n?g(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return p(this,e,t)}}:{add:function(e){return p(this,e,!0)}}),d}}},SaZh:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));n("9U97"),n("t3Gg"),n("y6Fo");var r=n("G3fq"),i=n.n(r);n("X42B");function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultToggleLabel=t.defaultToggleLabel,this.fieldName=t.fieldName,this.onSelect=t.onSelect||function(){},this.getDataOption=t.getData,this.getDataRemote=Boolean(t.filterRemote),this.createNewItemFromValueOption=t.createNewItemFromValue,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$createButton=this.$dropdownContainer.find(".js-dropdown-create-new-item"),this.buildDropdown(),this.bindEvents(),this.toggleFooter(!0)}var t,n,r;return t=e,(n=[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getData.bind(this),filterable:!0,filterRemote:this.getDataRemote,search:{fields:["text"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?i()(e.title):this.defaultToggleLabel},fieldName:this.fieldName,text:function(e){return i()(e.text)},id:function(e){return i()(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t){t.e.preventDefault(),e.onSelect()}})}},{key:"clearDropdown",value:function(){this.$dropdownContainer.find(".dropdown-content").html(""),this.$dropdownContainer.find(".dropdown-input-field").val("")}},{key:"bindEvents",value:function(){this.$createButton.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(e){e.preventDefault(),this.refreshData(),this.$dropdown.data("glDropdown").selectRowAtIndex()}},{key:"refreshData",value:function(){this.$dropdown.data("glDropdown").remote.execute()}},{key:"getData",value:function(e,t){var n=this;this.getDataOption(e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=n.selectedItem&&e.some((function(e){return e.id===n.selectedItem.id})),i=e;r||(i=e.concat(n.selectedItem||[])),t(i)}))}},{key:"createNewItemFromValue",value:function(e){return this.createNewItemFromValueOption?this.createNewItemFromValueOption(e):{title:e,id:e,text:e}}},{key:"toggleCreateNewButton",value:function(e){e&&(this.selectedItem=this.createNewItemFromValue(e),this.$dropdownContainer.find(".js-dropdown-create-new-item code").text(e)),this.toggleFooter(!e)}},{key:"toggleFooter",value:function(e){this.$dropdownFooter.toggleClass("hidden",e)}}])&&a(t.prototype,n),r&&a(t,r),e}()},UIJ9:function(e,t,n){"use strict";var r,i=n("kd5c"),a=n("zaKd"),o=n("YO8x"),s=n("g4su"),l=n("QxQF"),c=n("wZF9"),u=n("dPRI").enforce,d=n("XSeo"),f=!i.ActiveXObject&&"ActiveXObject"in i,v=Object.isExtensible,h=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},p=e.exports=s("WeakMap",h,l);if(d&&f){r=l.getConstructor(h,"WeakMap",!0),o.REQUIRED=!0;var b=p.prototype,g=b.delete,w=b.has,m=b.get,y=b.set;a(b,{delete:function(e){if(c(e)&&!v(e)){var t=u(this);return t.frozen||(t.frozen=new r),g.call(this,e)||t.frozen.delete(e)}return g.call(this,e)},has:function(e){if(c(e)&&!v(e)){var t=u(this);return t.frozen||(t.frozen=new r),w.call(this,e)||t.frozen.has(e)}return w.call(this,e)},get:function(e){if(c(e)&&!v(e)){var t=u(this);return t.frozen||(t.frozen=new r),w.call(this,e)?m.call(this,e):t.frozen.get(e)}return m.call(this,e)},set:function(e,t){if(c(e)&&!v(e)){var n=u(this);n.frozen||(n.frozen=new r),w.call(this,e)?y.call(this,e,t):n.frozen.set(e,t)}else y.call(this,e,t);return this}})}},jKN4:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));n("va8A"),n("kO4A"),n("t3Gg"),n("+kFb"),n("FMw2"),n("x/6R"),n("gyUR"),n("Z5ek"),n("yaFd"),n("4ql4"),n("y6Fo"),n("zCcL"),n("zpLX"),n("BD5p"),n("MRnW"),n("Ag57"),n("IdsT"),n("GzNv"),n("tbvx"),n("UIJ9"),n("++os"),n("Id6h"),n("orcL");var r=n("3a3M"),i=n.n(r),a=n("NmEs"),o=n("/lV4"),s=n("5PBi"),l=n("SaZh"),c=n("2Dmn");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=Object(o.d)("CiVariable|All environments");function p(e){return{title:"*"===e?h:e,id:e,text:"*"===e?Object(o.d)("CiVariable|* (All environments)"):e}}var b=function(){function e(t){var n=t.container,r=t.formField,a=t.maskableRegex;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=i()(n),this.formField=r,this.maskableRegex=new RegExp(a),this.environmentDropdownMap=new WeakMap,this.inputMap={id:{selector:".js-ci-variable-input-id",default:""},variable_type:{selector:".js-ci-variable-input-variable-type",default:"env_var"},key:{selector:".js-ci-variable-input-key",default:""},secret_value:{selector:".js-ci-variable-input-value",default:""},protected:{selector:".js-ci-variable-input-protected",default:i()(".js-ci-variable-input-protected").attr("data-default")},masked:{selector:".js-ci-variable-input-masked",default:i()(".js-ci-variable-input-masked").attr("data-default")},environment_scope:{selector:'input[name="'.concat(this.formField,'[variables_attributes][][environment_scope]"]'),default:"*"},_destroy:{selector:".js-ci-variable-input-destroy",default:""}},this.secretValues=new c.a({container:this.$container[0],valueSelector:".js-row:not(:last-child) .js-secret-value",placeholderSelector:".js-row:not(:last-child) .js-secret-value-placeholder"})}var t,n,r;return t=e,(n=[{key:"init",value:function(){this.bindEvents(),this.secretValues.init()}},{key:"bindEvents",value:function(){var e=this;this.$container.find(".js-row").each((function(t,n){e.initRow(n)})),this.$container.on("click",".js-row-remove-button",(function(t){t.preventDefault(),e.removeRow(i()(t.currentTarget).closest(".js-row"))}));var t=Object.keys(this.inputMap).map((function(t){return e.inputMap[t].selector})).join(",");this.$container.on("blur",t,(function(t){var n=i()(t.currentTarget).closest(".js-row");n.is(":not(:last-child)")&&!e.checkIfRowTouched(n)&&e.removeRow(n)})),this.$container.on("input trigger-change",t,(function(t){var n=e.$container.find(".js-row").last();e.checkIfRowTouched(n)&&e.insertRow(n),e.validateMaskability(i()(t.currentTarget).closest(".js-row"))}))}},{key:"initRow",value:function(e){var t=this,n=i()(e);Object(s.a)(n[0]),n.find(this.inputMap.secret_value.selector).css("height","");var r=n.find(".js-variable-environment-toggle");if(r.length){var a=new l.a({$dropdown:r,defaultToggleLabel:h,fieldName:"".concat(this.formField,"[variables_attributes][][environment_scope]"),getData:function(e,n){return n(t.getEnvironmentValues())},createNewItemFromValue:p,onSelect:function(){t.refreshDropdownData(),n.find(t.inputMap.environment_scope.selector).trigger("trigger-change")}});a.clearDropdown(),this.environmentDropdownMap.set(n[0],a)}}},{key:"insertRow",value:function(e){var t=this,n=e.clone();n.removeAttr("data-is-persisted"),Object.keys(this.inputMap).forEach((function(e){var r=t.inputMap[e];n.find(r.selector).val(r.default)})),n.find(".dropdown-menu.show").each((function(e,t){t.classList.remove("show")})),this.initRow(n),e.after(n)}},{key:"removeRow",value:function(e){var t=i()(e);Object(a.H)(t.attr("data-is-persisted"))?(t.hide(),t.find(this.inputMap._destroy.selector).val(!0)):t.remove(),this.refreshDropdownData()}},{key:"checkIfRowTouched",value:function(e){var t=this;return Object.keys(this.inputMap).some((function(n){if(["protected","masked"].includes(n))return!1;var r=t.inputMap[n],i=e.find(r.selector);return i.length&&i.val()!==r.default}))}},{key:"validateMaskability",value:function(e){var t=e.find(this.inputMap.secret_value.selector).val(),n=this.maskableRegex.test(t)||""===t,r="true"===e.find(this.inputMap.masked.selector).val();e.find(this.inputMap.secret_value.selector).toggleClass("gl-field-error-outline",r&&!n),e.find(".js-secret-value-placeholder").toggleClass("gl-field-error-outline",r&&!n),e.find(".masking-validation-error").toggle(r&&!n)}},{key:"toggleEnableRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$container.find(this.inputMap.key.selector).attr("disabled",!e),this.$container.find(".js-row-remove-button").attr("disabled",!e)}},{key:"hideValues",value:function(){this.secretValues.updateDom(!1)}},{key:"getAllData",value:function(){var e=this;return this.$container.find(".js-row").toArray().slice(0,-1).map((function(t){var n={};return Object.keys(e.inputMap).forEach((function(r){var a=e.inputMap[r],o=i()(t).find(a.selector);o.length&&(n[r]=o.val())})),n}))}},{key:"getEnvironmentValues",value:function(){var e=this.$container.find(this.inputMap.environment_scope.selector).toArray().reduce((function(e,t){return d(d({},e),{},f({},t.value,t.value))}),{});return Object.keys(e).map(p)}},{key:"refreshDropdownData",value:function(){var e=this;this.$container.find(".js-row").each((function(t,n){var r=e.environmentDropdownMap.get(n);r&&r.refreshData()}))}}])&&v(t.prototype,n),r&&v(t,r),e}()}}]);
//# sourceMappingURL=commons~pages.groups.settings.ci_cd.show~pages.projects.settings.ci_cd.show.04d15f5c.chunk.js.map