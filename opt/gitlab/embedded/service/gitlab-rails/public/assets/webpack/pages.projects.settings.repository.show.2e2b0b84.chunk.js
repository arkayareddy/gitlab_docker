(this.webpackJsonp=this.webpackJsonp||[]).push([[276],{181:function(t,e,s){s("HVBj"),s("gjpc"),t.exports=s("lPmm")},lPmm:function(t,e,s){"use strict";s.r(e);var n=s("1jeo"),o=(s("IdsT"),s("S26F"),s("Tmea")),r=s.n(o),i=s("3a3M"),a=s.n(i),h=s("/lV4"),d=s("XRO8"),u=s("2ibD"),c=(s("9U97"),s("t3Gg"),s("+kFb"),s("pBsb"),s("Id6h"),s("G3fq")),l=s.n(c),p=s("NmEs"),f="password",v="ssh_public_key";function $(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backOffRequestCounter=0,this.$form=a()(e),this.$repositoryUrl=this.$form.find(".js-repo-url"),this.$knownHosts=this.$form.find(".js-known-hosts"),this.$sectionSSHHostKeys=this.$form.find(".js-ssh-host-keys-section"),this.$hostKeysInformation=this.$form.find(".js-fingerprint-ssh-info"),this.$btnDetectHostKeys=this.$form.find(".js-detect-host-keys"),this.$btnSSHHostsShowAdvanced=this.$form.find(".btn-show-advanced"),this.$dropdownAuthType=this.$form.find(".js-mirror-auth-type"),this.$hiddenAuthType=this.$form.find(".js-hidden-mirror-auth-type"),this.$wellPasswordAuth=this.$form.find(".js-well-password-auth")}var e,s,n;return e=t,(s=[{key:"init",value:function(){var t=this;this.handleRepositoryUrlInput(!0),this.$repositoryUrl.on("keyup",(function(){return t.handleRepositoryUrlInput()})),this.$knownHosts.on("keyup",(function(e){return t.handleSSHKnownHostsInput(e)})),this.$dropdownAuthType.on("change",(function(e){return t.handleAuthTypeChange(e)})),this.$btnDetectHostKeys.on("click",(function(e){return t.handleDetectHostKeys(e)})),this.$btnSSHHostsShowAdvanced.on("click",(function(e){return t.handleSSHHostsAdvanced(e)}))}},{key:"handleRepositoryUrlInput",value:function(t){var e=this.$repositoryUrl.val().split("://")[0];if(t||this.$form.get(0).checkValidity()){var s="ssh"===e;this.$sectionSSHHostKeys.collapse(s?"show":"hide"),this.$btnDetectHostKeys.enable();var n=/http|git/.test(e);this.$dropdownAuthType.attr("disabled",n),t&&s?(this.$dropdownAuthType.val(v),this.toggleAuthWell(v)):(this.$dropdownAuthType.val(f),this.toggleAuthWell(f))}}},{key:"handleDetectHostKeys",value:function(){var t=this,e=this.$form.data("project-mirror-ssh-endpoint"),s=this.$repositoryUrl.val(),n=this.$knownHosts.val(),o=this.$btnDetectHostKeys.find(".js-spinner");this.$btnDetectHostKeys.disable(),o.removeClass("d-none"),Object(p.e)((function(o,r){u.a.get("".concat(e,"?ssh_url=").concat(s,"&compare_host_keys=").concat(encodeURIComponent(n))).then((function(e){var s=e.data;204===e.status?(t.backOffRequestCounter+=1,t.backOffRequestCounter<3?o():r(s)):r(s)})).catch(r)})).then((function(e){o.addClass("d-none"),t.$hostKeysInformation.find(".js-fingerprint-verification").collapse(e.host_keys_changed?"hide":"show"),e.known_hosts&&e.fingerprints&&t.showSSHInformation(e)})).catch((function(e){var s=e.response,n=s.data?s.data.message:Object(h.a)("An error occurred while detecting host keys");Object(d.a)(n),o.addClass("hidden"),t.$btnDetectHostKeys.enable()}))}},{key:"handleSSHKnownHostsInput",value:function(){this.$hostKeysInformation.find(".js-fingerprints-list").addClass("invalidate"),this.$hostKeysInformation.find(".js-fingerprint-verification").collapse("hide")}},{key:"handleSSHHostsAdvanced",value:function(){var t=this.$sectionSSHHostKeys.find(".js-ssh-known-hosts"),e=t.hasClass("show");t.collapse("toggle"),this.$btnSSHHostsShowAdvanced.toggleClass("show-advanced",e)}},{key:"handleAuthTypeChange",value:function(){var t=this.$dropdownAuthType.val();this.$wellPasswordAuth.collapse("hide"),this.updateHiddenAuthType(t),this.toggleAuthWell(t)}},{key:"showSSHInformation",value:function(t){var e=this.$hostKeysInformation.find(".js-fingerprints-list"),s="";t.fingerprints.forEach((function(t){var e=l()(t.fingerprint);s+="<code>".concat(e,"</code>")})),this.$hostKeysInformation.collapse("show"),e.removeClass("invalidate"),e.html(s),this.$sectionSSHHostKeys.find(".js-known-hosts").val(t.known_hosts)}},{key:"toggleAuthWell",value:function(t){this.$wellPasswordAuth.collapse(t===f?"show":"hide"),this.updateHiddenAuthType(t)}},{key:"updateHiddenAuthType",value:function(t){this.$hiddenAuthType.val(t),this.$hiddenAuthType.prop("disabled",t===v)}},{key:"destroy",value:function(){this.$repositoryUrl.off("keyup"),this.$form.find(".js-known-hosts").off("keyup"),this.$dropdownAuthType.off("change"),this.$btnDetectHostKeys.off("click"),this.$btnSSHHostsShowAdvanced.off("click")}}])&&$(e.prototype,s),n&&$(e,n),t}();function m(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$container=a()(e),this.$password=null,this.$form=a()(".js-mirror-form",this.$container),this.$urlInput=a()(".js-mirror-url",this.$form),this.$protectedBranchesInput=a()(".js-mirror-protected",this.$form),this.$table=a()(".js-mirrors-table-body",this.$container),this.mirrorEndpoint=this.$form.data("projectMirrorEndpoint")}var e,s,n;return e=t,(s=[{key:"init",value:function(){this.initMirrorPush(),this.registerUpdateListeners()}},{key:"initMirrorPush",value:function(){var t=this;this.$keepDivergentRefsInput=a()(".js-mirror-keep-divergent-refs",this.$form),this.$passwordGroup=a()(".js-password-group",this.$container),this.$password=a()(".js-password",this.$passwordGroup),this.$authMethod=a()(".js-auth-method",this.$form),this.$keepDivergentRefsInput.on("change",(function(){return t.updateKeepDivergentRefs()})),this.$authMethod.on("change",(function(){return t.togglePassword()})),this.$password.on("input.updateUrl",(function(){return t.debouncedUpdateUrl()})),this.initMirrorSSH(),this.updateProtectedBranches(),this.updateKeepDivergentRefs()}},{key:"initMirrorSSH",value:function(){this.$password&&this.$password.off("input.updateUrl"),this.$password=void 0,this.sshMirror=new y(".js-mirror-form"),this.sshMirror.init()}},{key:"updateUrl",value:function(){var t=this.$urlInput.val();if(this.$password){var e=this.$password.val();e&&(t=t.replace("@",":".concat(e,"@")))}a()(".js-mirror-url-hidden",this.$form).val(t)}},{key:"updateProtectedBranches",value:function(){var t=this.$protectedBranchesInput.get(0).checked?this.$protectedBranchesInput.val():"0";a()(".js-mirror-protected-hidden",this.$form).val(t)}},{key:"updateKeepDivergentRefs",value:function(){var t=this.$keepDivergentRefsInput.get(0);if(t){var e=t.checked?this.$keepDivergentRefsInput.val():"0";a()(".js-mirror-keep-divergent-refs-hidden",this.$form).val(e)}}},{key:"registerUpdateListeners",value:function(){var t=this;this.debouncedUpdateUrl=r()((function(){return t.updateUrl()}),200),this.$urlInput.on("input",(function(){return t.debouncedUpdateUrl()})),this.$protectedBranchesInput.on("change",(function(){return t.updateProtectedBranches()})),this.$table.on("click",".js-delete-mirror",(function(e){return t.deleteMirror(e)}))}},{key:"togglePassword",value:function(){var t="password"===this.$authMethod.val();t||(this.$password.val(""),this.updateUrl()),this.$passwordGroup.collapse(t?"show":"hide")}},{key:"deleteMirror",value:function(t,e){var s=this,n=a()(t.currentTarget),o=e;return o||(o={project:{remote_mirrors_attributes:{id:n.data("mirrorId"),_destroy:1}}}),u.a.put(this.mirrorEndpoint,o).then((function(){return s.removeRow(n)})).catch((function(){return Object(d.a)(Object(h.a)("Failed to remove mirror."))}))}},{key:"removeRow",value:function(t){var e=t.closest("tr");a()(".js-delete-mirror",e).tooltip("hide"),e.remove()}}])&&m(e.prototype,s),n&&m(e,n),t}();document.addEventListener("DOMContentLoaded",(function(){Object(n.a)();var t=document.querySelector(".js-mirror-settings");t&&new w(t).init()}))}},[[181,1,0,6,7,77]]]);
//# sourceMappingURL=pages.projects.settings.repository.show.2e2b0b84.chunk.js.map