(this.webpackJsonp=this.webpackJsonp||[]).push([[318],{HSIU:function(e,t,r){"use strict";r.r(t);r("9U97"),r("x/6R"),r("MRnW"),r("tbvx"),r("orcL"),r("pETN");var n=r("tDP3"),s={data:function(){return{inputEnabled:!1,urlOrRequestId:""}},methods:{toggleInput:function(){this.inputEnabled=!this.inputEnabled},addRequest:function(){this.$emit("add-request",this.urlOrRequestId),this.clearForm()},clearForm:function(){this.urlOrRequestId="",this.toggleInput()}}},a=r("tBpV"),i=Object(a.a)(s,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"view",attrs:{id:"peek-view-add-request"}},[r("form",{staticClass:"form-inline",on:{submit:function(e){e.preventDefault()}}},[r("button",{staticClass:"btn-blank btn-link bold",attrs:{type:"button",title:e.__("Add request manually")},on:{click:e.toggleInput}},[e._v("\n      +\n    ")]),e._v(" "),e.inputEnabled?r("input",{directives:[{name:"model",rawName:"v-model",value:e.urlOrRequestId,expression:"urlOrRequestId"}],staticClass:"form-control form-control-sm d-inline-block ml-1",attrs:{type:"text",placeholder:e.__("URL or request ID")},domProps:{value:e.urlOrRequestId},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addRequest(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.clearForm(t)}],input:function(t){t.target.composing||(e.urlOrRequestId=t.target.value)}}}):e._e()])])}),[],!1,null,null,null).exports,o=(r("gyUR"),r("A7K0")),u={components:{GlPopover:o.a},props:{htmlId:{type:String,required:!0},warnings:{type:Array,required:!0}},computed:{hasWarnings:function(){return this.warnings&&this.warnings.length},warningMessage:function(){return this.hasWarnings?this.warnings.join("\n"):""}},methods:{glEmojiTag:n.glEmojiTag}},l=Object(a.a)(u,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.hasWarnings?r("span",[r("span",{attrs:{id:e.htmlId},domProps:{innerHTML:e._s(e.glEmojiTag("warning"))}}),e._v(" "),r("gl-popover",{attrs:{target:e.htmlId,content:e.warningMessage,triggers:"hover focus"}})],1):e._e()}),[],!1,null,null,null).exports,c=r("Mifk"),d=r("len0"),m={components:{RequestWarning:l,GlModal:c.a,Icon:d.a},props:{currentRequest:{type:Object,required:!0},metric:{type:String,required:!0},title:{type:String,required:!1,default:function(){return this.metric}},header:{type:String,required:!0},keys:{type:Array,required:!0}},computed:{metricDetails:function(){return this.currentRequest.details[this.metric]},metricDetailsLabel:function(){return this.metricDetails.duration?"".concat(this.metricDetails.duration," / ").concat(this.metricDetails.calls):this.metricDetails.calls},detailsList:function(){return this.metricDetails.details},warnings:function(){return this.metricDetails.warnings||[]},htmlId:function(){return this.currentRequest?"performance-bar-warning-".concat(this.currentRequest.id,"-").concat(this.metric):""}}},h=Object(a.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.currentRequest.details&&e.metricDetails?r("div",{staticClass:"view",attrs:{id:"peek-view-"+e.metric,"data-qa-selector":"detailed_metric_content"}},[r("button",{staticClass:"btn-blank btn-link bold",attrs:{"data-target":"#modal-peek-"+e.metric+"-details",type:"button","data-toggle":"modal"}},[e._v("\n    "+e._s(e.metricDetailsLabel)+"\n  ")]),e._v(" "),r("gl-modal",{staticClass:"performance-bar-modal",attrs:{id:"modal-peek-"+e.metric+"-details","header-title-text":e.header,"modal-size":"xl"},scopedSlots:e._u([{key:"footer",fn:function(){return[r("div")]},proxy:!0}],null,!1,3545152822)},[r("table",{staticClass:"table"},[e.detailsList.length?e._l(e.detailsList,(function(t,n){return r("tr",{key:n},[r("td",[t.duration?r("span",[e._v(e._s(e.sprintf(e.__("%{duration}ms"),{duration:t.duration})))]):e._e()]),e._v(" "),r("td",[r("div",{staticClass:"js-toggle-container"},[e._l(e.keys,(function(n,s){return r("div",{key:n,staticClass:"break-word",class:{"mb-3 bold":0==s}},[e._v("\n                "+e._s(t[n])+"\n                "),0==s&&t.backtrace?r("button",{staticClass:"text-expander js-toggle-button",attrs:{type:"button","aria-label":e.__("Toggle backtrace")}},[r("icon",{attrs:{size:12,name:"ellipsis_h"}})],1):e._e()])})),e._v(" "),t.backtrace?r("pre",{staticClass:"backtrace-row js-toggle-content mt-2"},[e._v(e._s(t.backtrace))]):e._e()],2)])])})):[r("tr",[r("td",[e._v("\n            "+e._s(e.sprintf(e.__("No %{header} for this request."),{header:e.header.toLowerCase()}))+"\n          ")])])]],2)]),e._v("\n  "+e._s(e.title)+"\n  "),r("request-warning",{attrs:{"html-id":e.htmlId,warnings:e.warnings}})],1):e._e()}),[],!1,null,null,null).exports,p=(r("kO4A"),r("/lV4")),f={components:{GlPopover:o.a},props:{currentRequest:{type:Object,required:!0},requests:{type:Array,required:!0}},data:function(){return{currentRequestId:this.currentRequest.id}},computed:{requestsWithWarnings:function(){return this.requests.filter((function(e){return e.hasWarnings}))},warningMessage:function(){return Object(p.c)("%d request with warnings","%d requests with warnings",this.requestsWithWarnings.length)}},watch:{currentRequestId:function(e){this.$emit("change-current-request",e)}},methods:{glEmojiTag:n.glEmojiTag}},g={components:{AddRequest:i,DetailedMetric:h,RequestSelector:Object(a.a)(f,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"peek-request-selector","data-qa-selector":"request_dropdown"}},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.currentRequestId,expression:"currentRequestId"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.currentRequestId=t.target.multiple?r:r[0]}}},e._l(e.requests,(function(t){return r("option",{key:t.id,attrs:{"data-qa-selector":"request_dropdown_option"},domProps:{value:t.id}},[e._v("\n      "+e._s(t.truncatedUrl)+"\n      "),t.hasWarnings?r("span",[e._v("(!)")]):e._e()])})),0),e._v(" "),e.requestsWithWarnings.length?r("span",[r("span",{attrs:{id:"performance-bar-request-selector-warning"},domProps:{innerHTML:e._s(e.glEmojiTag("warning"))}}),e._v(" "),r("gl-popover",{attrs:{target:"performance-bar-request-selector-warning",content:e.warningMessage,triggers:"hover focus"}})],1):e._e()])}),[],!1,null,null,null).exports},props:{store:{type:Object,required:!0},env:{type:String,required:!0},requestId:{type:String,required:!0},peekUrl:{type:String,required:!0}},detailedMetrics:[{metric:"active-record",title:"pg",header:Object(p.d)("PerformanceBar|SQL queries"),keys:["sql"]},{metric:"bullet",header:Object(p.d)("PerformanceBar|Bullet notifications"),keys:["notification"]},{metric:"gitaly",header:Object(p.d)("PerformanceBar|Gitaly calls"),keys:["feature","request"]},{metric:"rugged",header:Object(p.d)("PerformanceBar|Rugged calls"),keys:["feature","args"]},{metric:"redis",header:Object(p.d)("PerformanceBar|Redis calls"),keys:["cmd","instance"]},{metric:"es",header:Object(p.d)("PerformanceBar|Elasticsearch calls"),keys:["request","body"]},{metric:"total",header:Object(p.d)("PerformanceBar|Frontend resources"),keys:["name","size"]}],data:function(){return{currentRequestId:""}},computed:{requests:function(){return this.store.requestsWithDetails()},currentRequest:{get:function(){return this.store.findRequest(this.currentRequestId)},set:function(e){this.currentRequestId=e}},initialRequest:function(){return this.currentRequestId===this.requestId},hasHost:function(){return this.currentRequest&&this.currentRequest.details&&this.currentRequest.details.host},birdEmoji:function(){return this.hasHost&&this.currentRequest.details.host.canary?Object(n.glEmojiTag)("baby_chick"):""},downloadPath:function(){var e=JSON.stringify(this.requests),t=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(t)},downloadName:function(){var e=this.requests[0].truncatedUrl;return"".concat(e,"_perf_bar_").concat(Date.now(),".json")}},mounted:function(){this.currentRequest=this.requestId},methods:{changeCurrentRequest:function(e){this.currentRequest=e}}},_=Object(a.a)(g,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:e.env,attrs:{id:"js-peek"}},[e.currentRequest?r("div",{staticClass:"d-flex container-fluid container-limited",attrs:{"data-qa-selector":"performance_bar"}},[r("div",{staticClass:"view",attrs:{id:"peek-view-host"}},[e.hasHost?r("span",{staticClass:"current-host",class:{canary:e.currentRequest.details.host.canary}},[r("span",{domProps:{innerHTML:e._s(e.birdEmoji)}}),e._v("\n        "+e._s(e.currentRequest.details.host.hostname)+"\n      ")]):e._e()]),e._v(" "),e._l(e.$options.detailedMetrics,(function(t){return r("detailed-metric",{key:t.metric,attrs:{"current-request":e.currentRequest,metric:t.metric,title:t.title,header:t.header,keys:t.keys}})})),e._v(" "),e.currentRequest.details&&e.currentRequest.details.tracing?r("div",{staticClass:"view",attrs:{id:"peek-view-trace"}},[r("a",{attrs:{href:e.currentRequest.details.tracing.tracing_url}},[e._v(e._s(e.s__("PerformanceBar|trace")))])]):e._e(),e._v(" "),r("add-request",e._g({},e.$listeners)),e._v(" "),e.currentRequest.details?r("div",{staticClass:"view",attrs:{id:"peek-download"}},[r("a",{attrs:{download:e.downloadName,href:e.downloadPath}},[e._v(e._s(e.s__("PerformanceBar|Download")))])]):e._e(),e._v(" "),e.currentRequest?r("request-selector",{staticClass:"ml-auto",attrs:{"current-request":e.currentRequest,requests:e.requests},on:{"change-current-request":e.changeCurrentRequest}}):e._e()],2):e._e()])}),[],!1,null,null,null);t.default=_.exports},Mifk:function(e,t,r){"use strict";r("FMw2");var n=r("3a3M"),s=r.n(n),a=["danger","primary","success","warning"],i=["sm","md","lg","xl"],o={name:"DeprecatedModal2",props:{id:{type:String,required:!1,default:null},modalSize:{type:String,required:!1,default:"md",validator:function(e){return i.includes(e)}},headerTitleText:{type:String,required:!1,default:""},footerPrimaryButtonVariant:{type:String,required:!1,default:"primary",validator:function(e){return a.includes(e)}},footerPrimaryButtonText:{type:String,required:!1,default:""}},computed:{modalSizeClass:function(){return"md"===this.modalSize?"":"modal-".concat(this.modalSize)}},mounted:function(){s()(this.$el).on("shown.bs.modal",this.opened).on("hidden.bs.modal",this.closed)},beforeDestroy:function(){s()(this.$el).off("shown.bs.modal",this.opened).off("hidden.bs.modal",this.closed)},methods:{emitCancel:function(e){this.$emit("cancel",e)},emitSubmit:function(e){this.$emit("submit",e)},opened:function(){this.$emit("open")},closed:function(){this.$emit("closed")}}},u=r("tBpV"),l=Object(u.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"modal fade",attrs:{id:e.id,tabindex:"-1",role:"dialog"}},[r("div",{staticClass:"modal-dialog",class:e.modalSizeClass,attrs:{role:"document"}},[r("div",{staticClass:"modal-content"},[r("div",{staticClass:"modal-header"},[e._t("header",[r("h4",{staticClass:"modal-title"},[e._t("title",[e._v(" "+e._s(e.headerTitleText)+" ")])],2),e._v(" "),r("button",{staticClass:"close js-modal-close-action",attrs:{"aria-label":e.s__("Modal|Close"),type:"button","data-dismiss":"modal"},on:{click:function(t){return e.emitCancel(t)}}},[r("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])],2),e._v(" "),r("div",{staticClass:"modal-body"},[e._t("default")],2),e._v(" "),r("div",{staticClass:"modal-footer"},[e._t("footer",[r("button",{staticClass:"btn js-modal-cancel-action qa-modal-cancel-button",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(t){return e.emitCancel(t)}}},[e._v("\n            "+e._s(e.s__("Modal|Cancel"))+"\n          ")]),e._v(" "),r("button",{staticClass:"btn js-modal-primary-action qa-modal-primary-button",class:"btn-"+e.footerPrimaryButtonVariant,attrs:{type:"button","data-dismiss":"modal"},on:{click:function(t){return e.emitSubmit(t)}}},[e._v("\n            "+e._s(e.footerPrimaryButtonText)+"\n          ")])])],2)])])])}),[],!1,null,null,null);t.a=l.exports}}]);
//# sourceMappingURL=318.e1904aa0.chunk.js.map