(this.webpackJsonp=this.webpackJsonp||[]).push([[156],{61:function(t,e,i){i("HVBj"),t.exports=i("xJDz")},VQ4T:function(t,e,i){"use strict";e.a={EMPTY:"empty",LOADING:"loading",LIST:"list",NO_INTEGRATION:"no-integration"}},jF6B:function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));i("9U97"),i("t3Gg"),i("+kFb"),i("Id6h");var s=i("G3fq"),n=i.n(s),r=i("3a3M"),a=i.n(r),o=i("/lV4"),c=i("2ibD"),d=i("VQ4T"),h=i("NmEs");function l(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var m=function(){function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backOffRequestCounter=0,this.$wrapper=a()(e),this.$monitoredMetricsPanel=this.$wrapper.find(".js-panel-monitored-metrics"),this.$monitoredMetricsCount=this.$monitoredMetricsPanel.find(".js-monitored-count"),this.$monitoredMetricsLoading=this.$monitoredMetricsPanel.find(".js-loading-metrics"),this.$monitoredMetricsEmpty=this.$monitoredMetricsPanel.find(".js-empty-metrics"),this.$monitoredMetricsList=this.$monitoredMetricsPanel.find(".js-metrics-list"),this.$missingEnvVarPanel=this.$wrapper.find(".js-panel-missing-env-vars"),this.$panelToggle=this.$missingEnvVarPanel.find(".js-panel-toggle"),this.$missingEnvVarMetricCount=this.$missingEnvVarPanel.find(".js-env-var-count"),this.$missingEnvVarMetricsList=this.$missingEnvVarPanel.find(".js-missing-var-metrics-list"),this.activeMetricsEndpoint=this.$monitoredMetricsPanel.data("activeMetrics"),this.helpMetricsPath=this.$monitoredMetricsPanel.data("metrics-help-path"),this.$panelToggle.on("click",(function(t){return i.handlePanelToggle(t)}))}var e,i,s;return e=t,(i=[{key:"init",value:function(){this.loadActiveMetrics()}},{key:"handlePanelToggle",value:function(t){var e=a()(t.currentTarget);e.closest(".card").find(".card-body").toggleClass("hidden"),e.hasClass("fa-caret-down")?e.removeClass("fa-caret-down").addClass("fa-caret-right"):e.removeClass("fa-caret-right").addClass("fa-caret-down")}},{key:"showMonitoringMetricsPanelState",value:function(t){switch(t){case d.a.LOADING:this.$monitoredMetricsLoading.removeClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.addClass("hidden");break;case d.a.LIST:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.removeClass("hidden");break;default:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.removeClass("hidden"),this.$monitoredMetricsList.addClass("hidden")}}},{key:"populateActiveMetrics",value:function(t){var e=this,i=0,s=0,r=0;if(t.forEach((function(t){t.active_metrics>0&&(r+=1,e.$monitoredMetricsList.append("<li>".concat(n()(t.group),'<span class="badge">').concat(n()(t.active_metrics),"</span></li>")),i+=t.active_metrics,t.metrics_missing_requirements>0&&(e.$missingEnvVarMetricsList.append("<li>".concat(n()(t.group),"</li>")),s+=1))})),0===i){var a=Object(o.e)(Object(o.d)('PrometheusService|<p class="text-tertiary">No <a href="%{docsUrl}">common metrics</a> were found</p>'),{docsUrl:this.helpMetricsPath},!1);this.$monitoredMetricsEmpty.empty(),this.$monitoredMetricsEmpty.append(a),this.showMonitoringMetricsPanelState(d.a.EMPTY)}else{var c=Object(o.e)(Object(o.d)("PrometheusService|%{exporters} with %{metrics} were found"),{exporters:Object(o.c)("%d exporter","%d exporters",r),metrics:Object(o.c)("%d metric","%d metrics",i)});this.$monitoredMetricsCount.text(c),this.showMonitoringMetricsPanelState(d.a.LIST),s>0&&(this.$missingEnvVarPanel.removeClass("hidden"),this.$missingEnvVarMetricCount.text(s))}}},{key:"loadActiveMetrics",value:function(){var t=this;this.showMonitoringMetricsPanelState(d.a.LOADING),Object(h.e)((function(e,i){c.a.get(t.activeMetricsEndpoint).then((function(s){var n=s.data;n&&n.success?i(n):(t.backOffRequestCounter+=1,t.backOffRequestCounter<3?e():i(n))})).catch(i)})).then((function(e){e&&e.data&&e.data.length?t.populateActiveMetrics(e.data):t.showMonitoringMetricsPanelState(d.a.EMPTY)})).catch((function(){t.showMonitoringMetricsPanelState(d.a.EMPTY)}))}}])&&l(e.prototype,i),s&&l(e,s),t}()},xJDz:function(t,e,i){"use strict";i.r(e);var s=i("Bl6y"),n=i("jF6B"),r=i("8MWd");document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector(".js-prometheus-metrics-monitoring");(new s.a(".js-integration-settings-form").init(),t)&&new n.a(".js-prometheus-metrics-monitoring").loadActiveMetrics();Object(r.a)(document.querySelector(".js-alerts-service-settings"))}))}},[[61,1,0,13,39]]]);
//# sourceMappingURL=pages.groups.settings.integrations.edit.b115e6d3.chunk.js.map