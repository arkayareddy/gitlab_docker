(this.webpackJsonp=this.webpackJsonp||[]).push([[31],{"1ZpL":function(e,t,n){var i,r,a;
/*! waitForImages jQuery Plugin - v2.1.0 - 2016-01-04
* https://github.com/alexanderdickson/waitForImages
* Copyright (c) 2016 Alex Dickson; Licensed MIT */r=[n("3a3M")],void 0===(a="function"==typeof(i=function(e){e.waitForImages={hasImageProperties:["backgroundImage","listStyleImage","borderImage","borderCornerImage","cursor"],hasImageAttributes:["srcset"]},e.expr[":"]["has-src"]=function(t){return e(t).is('img[src][src!=""]')},e.expr[":"].uncached=function(t){return!!e(t).is(":has-src")&&!t.complete},e.fn.waitForImages=function(){var t,n,i,r=0,a=0,o=e.Deferred();if(e.isPlainObject(arguments[0])?(i=arguments[0].waitForAll,n=arguments[0].each,t=arguments[0].finished):1===arguments.length&&"boolean"===e.type(arguments[0])?i=arguments[0]:(t=arguments[0],n=arguments[1],i=arguments[2]),t=t||e.noop,n=n||e.noop,i=!!i,!e.isFunction(t)||!e.isFunction(n))throw new TypeError("An invalid callback was supplied.");return this.each((function(){var s=e(this),c=[],l=e.waitForImages.hasImageProperties||[],u=e.waitForImages.hasImageAttributes||[],f=/url\(\s*(['"]?)(.*?)\1\s*\)/g;i?s.find("*").addBack().each((function(){var t=e(this);t.is("img:has-src")&&!t.is("[srcset]")&&c.push({src:t.attr("src"),element:t[0]}),e.each(l,(function(e,n){var i,r=t.css(n);if(!r)return!0;for(;i=f.exec(r);)c.push({src:i[2],element:t[0]})})),e.each(u,(function(e,n){if(!t.attr(n))return!0;c.push({src:t.attr("src"),srcset:t.attr("srcset"),element:t[0]})}))})):s.find("img:has-src").each((function(){c.push({src:this.src,element:this})})),r=c.length,a=0,0===r&&(t.call(s[0]),o.resolveWith(s[0])),e.each(c,(function(i,c){var l=new Image,u="load.waitForImages error.waitForImages";e(l).one(u,(function i(l){var f=[a,r,"load"==l.type];if(a++,n.apply(c.element,f),o.notifyWith(c.element,f),e(this).off(u,i),a==r)return t.call(s[0]),o.resolveWith(s[0]),!1})),c.srcset&&(l.srcset=c.srcset),l.src=c.src}))})),o.promise()}})?i.apply(t,r):i)||(e.exports=a)},DN5t:function(e,t,n){"use strict";n.d(t,"a",(function(){return se}));n("va8A"),n("z4I3"),n("dj/k"),n("9U97"),n("kO4A"),n("t3Gg"),n("OZM5"),n("x/6R"),n("Z5ek"),n("4ql4"),n("8Qi2"),n("MRnW"),n("IdsT"),n("GzNv"),n("tbvx"),n("pBsb"),n("orcL");var i=n("3a3M"),r=n.n(i),a=n("2ibD"),o=n("XRO8"),s=n("/lV4"),c=n("3twG"),l=n("06tH"),u=n.n(l),f=".".concat("diff-line-num",", .line_content"),d={init:function(e){var t=this;this.userCanCreateNote||(this.userCanCreateNote=""===e.closest(".files").data("canCreateNote")),this.isParallelView="parallel"===u.a.get("diff_view"),this.userCanCreateNote&&e.on("mouseover",f,(function(e){return t.showButton(t.isParallelView,e)})).on("mouseleave",f,(function(e){return t.hideButton(t.isParallelView,e)}))},showButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);this.validateButtonParent(n)&&(n.classList.add("is-over"),n.nextElementSibling.classList.add("is-over"))},hideButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);n.classList.remove("is-over"),n.nextElementSibling.classList.remove("is-over")},getButtonParent:function(e,t){if(t){if(!e.classList.contains("diff-line-num"))return e.previousElementSibling}else if(!e.classList.contains("old_line"))return e.parentNode.querySelector(".".concat("old_line"));return e},validateButtonParent:function(e){return!(e.classList.contains("empty-cell")||e.classList.contains("js-unfold")||e.classList.contains("no-comment-btn")||e.parentNode.classList.contains("diff-expanded"))}},h=(n("+kFb"),n("jnfO"),n("zCcL"),n("zpLX"),n("BD5p"),n("Id6h"),n("NmEs"));function g(e,t){var n=t.x,i=t.y,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=document.createElement("button");return r.concat(["js-image-badge"]).forEach((function(e){return a.classList.add(e)})),a.setAttribute("type","button"),a.setAttribute("disabled",!0),a.dataset.noteId=e,a.style.left="".concat(n,"px"),a.style.top="".concat(i,"px"),a}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){var n=t.x,i=t.y,r=document.createElement("button");r.classList.add("btn-transparent"),r.classList.add("comment-indicator"),r.setAttribute("type","button"),r.style.left="".concat(n,"px"),r.style.top="".concat(i,"px"),r.innerHTML=Object(h.V)("image-comment-dark"),e.appendChild(r)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C={x:0,y:0,width:0,height:0},I=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.noteId,i=t.discussionId;this.actual=t.actual||C,this.browser=t.browser||C,this.noteId=n,this.discussionId=i,t.imageEl&&!t.browser&&(this.browser=j.resizeCoordinatesToImageElement(t.imageEl,this.actual))};var j={addCommentIndicator:b,removeCommentIndicator:function(e){var t=e.querySelector(".comment-indicator"),n=e.querySelector("img"),i=Boolean(t),r={};return i&&(r={x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),image:{width:n.width,height:n.height}},t.remove()),p(p({},r),{},{removed:i})},showCommentIndicator:function(e,t){var n=t.x,i=t.y,r=e.querySelector(".comment-indicator");r?(r.style.left="".concat(n,"px"),r.style.top="".concat(i,"px")):b(e,t)},commentIndicatorOnClick:function(e){e.stopPropagation(),e.currentTarget.closest(".diff-viewer").querySelector(".note-container .note-textarea").focus()},addImageBadge:function(e,t){var n=t.coordinate,i=t.badgeText,r=g(t.noteId,n,["badge","badge-pill"]);r.textContent=i,e.appendChild(r)},addImageCommentBadge:function(e,t){var n=t.coordinate,i=g(t.noteId,n,["image-comment-badge"]);i.innerHTML=Object(h.V)("image-comment-dark"),e.appendChild(i)},addAvatarBadge:function(e,t){var n=t.detail,i=n.noteId,r=n.badgeNumber,a=e.querySelector("#".concat(i," .badge"));a.textContent=r,a.classList.remove("hidden")},setPositionDataAttribute:function(e,t){var n=t.x,i=t.y,r=t.width,a=t.height,o=e.dataset.position,s=w(w({},JSON.parse(o)),{},{x:n,y:i,width:r,height:a});e.setAttribute("data-position",JSON.stringify(s))},updateDiscussionAvatarBadgeNumber:function(e,t){e.querySelector(".image-diff-avatar-link .badge").textContent=t},updateDiscussionBadgeNumber:function(e,t){e.querySelector(".badge").textContent=t},toggleCollapsed:function(e){var t=e.currentTarget.closest(".discussion-notes"),n=t.querySelector(".discussion-form"),i=t.classList.contains("collapsed");i?t.classList.remove("collapsed"):t.classList.add("collapsed"),n&&!i?n.style.display="none":n&&i&&(n.style.display="block")},resizeCoordinatesToImageElement:function(e,t){var n=t.x,i=t.y,r=t.width,a=t.height,o=e.width,s=e.height,c=o/r,l=s/a;return{x:Math.round(n*c),y:Math.round(i*l),width:o,height:s}},generateBadgeFromDiscussionDOM:function(e,t){var n=JSON.parse(t.dataset.position),i=t.querySelector(".note");return new I({actual:n,imageEl:e.querySelector("img"),noteId:i.id,discussionId:t.dataset.discussionId})},getTargetSelection:function(e){var t=e.currentTarget.querySelector("img"),n=e.offsetX,i=e.offsetY,r=t.width,a=t.height,o=t.naturalWidth,s=t.naturalHeight,c=o/r,l=s/a,u=Math.max(0,n)&&Math.min(n,r),f=Math.max(0,i)&&Math.min(i,a);return{browser:{x:u,y:f,width:r,height:a},actual:{x:Math.round(u*c),y:Math.round(f*l),width:o,height:s}}}};function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.canCreateNote=Boolean(n&&n.canCreateNote),this.renderCommentBadge=Boolean(n&&n.renderCommentBadge),this.$noteContainer=r()(".note-container",this.el),this.imageBadges=[]}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.imageFrameEl=this.el.querySelector(".diff-file .js-image-frame"),this.imageEl=this.imageFrameEl.querySelector("img"),this.bindEvents()}},{key:"bindEvents",value:function(){var e;this.imageClickedWrapper=this.imageClicked.bind(this),this.imageBlurredWrapper=j.removeCommentIndicator.bind(null,this.imageFrameEl),this.addBadgeWrapper=this.addBadge.bind(this),this.removeBadgeWrapper=this.removeBadge.bind(this),this.renderBadgesWrapper=this.renderBadges.bind(this),(e=this.imageEl).complete&&0!==e.naturalHeight?this.renderBadges():this.imageEl.addEventListener("load",this.renderBadgesWrapper),this.$noteContainer.on("click",".js-diff-notes-toggle",j.toggleCollapsed),r()(this.el).on("click",".comment-indicator",j.commentIndicatorOnClick),this.canCreateNote&&(this.el.addEventListener("click.imageDiff",this.imageClickedWrapper),this.el.addEventListener("blur.imageDiff",this.imageBlurredWrapper),this.el.addEventListener("addBadge.imageDiff",this.addBadgeWrapper),this.el.addEventListener("removeBadge.imageDiff",this.removeBadgeWrapper))}},{key:"imageClicked",value:function(e){var t=e.detail,n=j.getTargetSelection(t),i=t.currentTarget;j.setPositionDataAttribute(i,n.actual),j.showCommentIndicator(this.imageFrameEl,n.browser)}},{key:"renderBadges",value:function(){P(this.el.querySelectorAll(".note-container .discussion-notes .notes")).forEach(this.renderBadge.bind(this))}},{key:"renderBadge",value:function(e,t){var n=j.generateBadgeFromDiscussionDOM(this.imageFrameEl,e);this.imageBadges.push(n);var i={coordinate:n.browser,noteId:n.noteId};if(this.renderCommentBadge)j.addImageCommentBadge(this.imageFrameEl,i);else{var r=E(E({},i),{},{badgeText:t+1});j.addImageBadge(this.imageFrameEl,r)}}},{key:"addBadge",value:function(e){var t=e.detail,n=t.x,i=t.y,r=t.width,a=t.height,o=t.noteId,s=t.discussionId,c=this.imageBadges.length+1,l=new I({actual:{x:n,y:i,width:r,height:a},imageEl:this.imageFrameEl.querySelector("img"),noteId:o,discussionId:s});this.imageBadges.push(l),j.addImageBadge(this.imageFrameEl,{coordinate:l.browser,badgeText:c,noteId:o}),j.addAvatarBadge(this.el,{detail:{noteId:o,badgeNumber:c}});var u=this.el.querySelector("#discussion_".concat(s));j.updateDiscussionBadgeNumber(u,c)}},{key:"removeBadge",value:function(e){var t=this,n=e.detail.badgeNumber,i=n-1,r=this.imageFrameEl.querySelectorAll(".badge");this.imageBadges.length!==n&&this.imageBadges.forEach((function(e,n){if(n>i){var a=e.discussionId,o=n,s=t.el.querySelector("#discussion_".concat(a));r[n].textContent=o,j.updateDiscussionBadgeNumber(s,o),j.updateDiscussionAvatarBadgeNumber(s,o)}})),this.imageBadges.splice(i,1),r[i].remove()}}])&&N(t.prototype,n),i&&N(t,i),e}(),x=(n("T85t"),n("WQYg"),n("EfZm"),n("arjl"),{TWO_UP:"TWO_UP",SWIPE:"SWIPE",ONION_SKIN:"ONION_SKIN"});function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function M(e,t,n){return(M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=U(e);if(t){var r=U(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _(this,n)}}function _(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(a,e);var t,n,i,r=V(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),r.apply(this,arguments)}return t=a,(n=[{key:"init",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.TWO_UP;this.imageFrameEls=(L(e={},x.TWO_UP,this.el.querySelector(".two-up .js-image-frame")),L(e,x.SWIPE,this.el.querySelector(".swipe .js-image-frame")),L(e,x.ONION_SKIN,this.el.querySelector(".onion-skin .js-image-frame")),e);var i=this.el.querySelector(".view-modes-menu");this.viewModesEls=(L(t={},x.TWO_UP,i.querySelector(".two-up")),L(t,x.SWIPE,i.querySelector(".swipe")),L(t,x.ONION_SKIN,i.querySelector(".onion-skin")),t),this.currentView=n,this.generateImageEls(),this.bindEvents()}},{key:"generateImageEls",value:function(){var e=this;this.imageEls={},Object.getOwnPropertyNames(x).forEach((function(t){e.imageEls[t]=e.imageFrameEls[t].querySelector("img")}))}},{key:"bindEvents",value:function(){M(U(a.prototype),"bindEvents",this).call(this),this.changeToViewTwoUp=this.changeView.bind(this,x.TWO_UP),this.changeToViewSwipe=this.changeView.bind(this,x.SWIPE),this.changeToViewOnionSkin=this.changeView.bind(this,x.ONION_SKIN),this.viewModesEls[x.TWO_UP].addEventListener("click",this.changeToViewTwoUp),this.viewModesEls[x.SWIPE].addEventListener("click",this.changeToViewSwipe),this.viewModesEls[x.ONION_SKIN].addEventListener("click",this.changeToViewOnionSkin)}},{key:"changeView",value:function(e){if(t=e,Boolean(Object.getOwnPropertyNames(x).find((function(e){return e===t})))){var t,n=j.removeCommentIndicator(this.imageFrameEl);this.currentView=e,A(this.imageFrameEl.querySelectorAll(".badge")).map((function(e){return e.remove()})),this.imageBadges=[],setTimeout(this.renderNewView.bind(this,n),250)}}},{key:"renderNewView",value:function(e){if(this.renderBadges(),e.removed){var t=j.resizeCoordinatesToImageElement(this.imageEl,{x:e.x,y:e.y,width:e.image.width,height:e.image.height});j.showCommentIndicator(this.imageFrameEl,t)}}},{key:"imageEl",get:function(){return this.imageEls[this.currentView]}},{key:"imageFrameEl",get:function(){return this.imageFrameEls[this.currentView]}}])&&q(t.prototype,n),i&&q(t,i),a}(D);n("S26F"),n("1ZpL");function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var z=900,J=["two-up","swipe"],K=function(){function e(t){var n,i,a,o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a={"two-up":function(){var e=this;return r()(".two-up.view .wrap",this.file).each((function(t,n){return r()("img",n).each((function(){if(r()(this).width()>z/2)return r()(this).width(z/2)})),e.requestImageInfo(r()("img",n),(function(e,t){return r()(".image-info .meta-width",n).text("".concat(e,"px")),r()(".image-info .meta-height",n).text("".concat(t,"px")),r()(".image-info",n).removeClass("hide")}))}))},swipe:function(){var t=this,n=0,i=0;return r()(".swipe.view",this.file).each((function(a,o){var s=$(e.prepareFrames(o),2);n=s[0],i=s[1];var c=r()(".swipe-frame",o),l=r()(".swipe-wrap",o),u=r()(".swipe-bar",o);c.css({width:n+16,height:i+28}),l.css({width:n+1,height:i+2}),u.css({left:1});var f=parseInt(l.css("right").replace("px",""),10);t.initDraggable(u,f,(function(e,t){t>0&&t<c.width()-2*f&&(l.width(n+1-t),u.css("left",t))}))}))},"onion-skin":function(){var t,n,i=this;n=0,t=0;var a=r()(".drag-track",this.file).width()-r()(".dragger",this.file).width();return r()(".onion-skin.view",this.file).each((function(o,s){var c=$(e.prepareFrames(s),2);n=c[0],t=c[1];var l=r()(".onion-skin-frame",s),u=r()(".frame.added",s),f=r()(".drag-track",s),d=r()(".dragger",f);l.css({width:n+16,height:t+28}),r()(".swipe-wrap",s).css({width:n+1,height:t+2}),d.css({left:a}),u.css("opacity",1);var h=parseInt(u.css("right").replace("px",""),10);i.initDraggable(d,h,(function(e,t){var n=t/a;n>=0&&n<=1&&(d.css("left",t),u.css("opacity",n))}))}))}},(i="views")in(n=this)?Object.defineProperty(n,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[i]=a,this.file=t,this.requestImageInfo(r()(".two-up.view .frame.deleted img",this.file),(function(){return o.requestImageInfo(r()(".two-up.view .frame.added img",o.file),(function(){o.initViewModes(),r()(".two-up.view img",o.file).waitForImages((function(){o.initView("two-up")}))}))}))}var t,n,i;return t=e,i=[{key:"prepareFrames",value:function(e){var t=0,n=0;return r()(".frame",e).each((function(e,i){var a=r()(i).width(),o=r()(i).height();return t=a>t?a:t,n=o>n?o:n})).css({width:t,height:n}),[t,n]}}],(n=[{key:"initViewModes",value:function(){var e=this,t=J[0];return r()(".view-modes",this.file).removeClass("hide"),r()(".view-modes-menu",this.file).on("click","li",(function(t){if(!r()(t.currentTarget).hasClass("active"))return e.activateViewMode(t.currentTarget.className)})),this.activateViewMode(t)}},{key:"activateViewMode",value:function(e){var t=this;return r()(".view-modes-menu li",this.file).removeClass("active").filter(".".concat(e)).addClass("active"),r()(".view:visible:not(.".concat(e,")"),this.file).fadeOut(200,(function(){return r()(".view.".concat(e),t.file).fadeIn(200),t.initView(e)}))}},{key:"initView",value:function(e){return this.views[e].call(this)}},{key:"initDraggable",value:function(e,t,n){var i=!1,a=r()("body"),o=e.parent(),s=function(){i=!0,a.css("user-select","none")},c=function(){i=!1,a.css("user-select","")},l=function(e){var r=(e.pageX||e.touches[0].pageX)-(o.offset().left+t);i&&n(e,r)};e.off("mousedown").off("touchstart").on("mousedown",s).on("touchstart",s),a.off("mouseup").off("mousemove").off("touchend").off("touchmove").on("mouseup",c).on("touchend",c).on("mousemove",l).on("touchmove",l)}},{key:"requestImageInfo",value:function(e,t){var n=this,i=e.get(0);if(i)return i.complete?t.call(this,i.naturalWidth,i.naturalHeight):e.on("load",(function(){return t.call(n,i.naturalWidth,i.naturalHeight)}))}}])&&Z(t.prototype,n),i&&Z(t,i),e}();var X={initImageDiff:function(e,t,n){var i,r={canCreateNote:t,renderCommentBadge:n};return new K(e),e.querySelector(".diff-file .js-single-image")?(i=new D(e,r)).init():e.querySelector(".diff-file .js-replaced-image")&&(i=new R(e,r)).init(),i}},G=n("FYnm");function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Y='<div class="diff-content"></div>',ee='<span class="spinner"></span>',te='<div class="nothing-here-block diff-collapsed">This diff is collapsed. <button class="click-to-expand btn btn-link">Click to expand it.</button></div>',ne=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.toggleDiff=this.toggleDiff.bind(this),this.content=r()(".diff-content",this.file),this.$toggleIcon=r()(".diff-toggle-caret",this.file),this.diffForPath=this.content.find("[data-diff-for-path]").data("diffForPath"),this.isOpen=!this.diffForPath,this.diffForPath?(this.collapsedContent=this.content,this.loadingContent=r()(Y).addClass("loading").html(ee).hide(),this.content=null,this.collapsedContent.after(this.loadingContent),this.$toggleIcon.addClass("fa-caret-right")):(this.collapsedContent=r()(Y).html(te).hide(),this.content.after(this.collapsedContent),this.$toggleIcon.addClass("fa-caret-down")),r()(".js-file-title, .click-to-expand",this.file).on("click",(function(e){n.toggleDiff(r()(e.target))}))}var t,n,i;return t=e,(n=[{key:"toggleDiff",value:function(e,t){if(e.hasClass("js-file-title")||e.hasClass("click-to-expand")||e.hasClass("diff-toggle-caret"))if(this.isOpen=!this.isOpen,this.isOpen||this.hasError){if(!this.content)return this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),this.getContentHTML(t);this.collapsedContent.hide(),this.content.show(),this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}else this.content.hide(),this.$toggleIcon.addClass("fa-caret-right").removeClass("fa-caret-down"),this.collapsedContent.show(),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"getContentHTML",value:function(e){var t=this;this.collapsedContent.hide(),this.loadingContent.show(),a.a.get(this.diffForPath).then((function(n){var i=n.data;t.loadingContent.hide(),i.html?(t.content=r()(i.html),Object(G.a)(t.content)):(t.hasError=!0,t.content=r()('<div class="nothing-here-block"><i class="fa fa-warning"></i> Could not load diff</div>')),t.collapsedContent.after(t.content),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents();var a=r()(t.file);d.init(a);var o=a.closest(".files").is("[data-can-create-note]");X.initImageDiff(a[0],o),e&&e()})).catch((function(){Object(o.a)(Object(s.a)("An error occurred while retrieving diff"))}))}}])&&Q(t.prototype,n),i&&Q(t,i),e}();function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ae(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var oe=!1,se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=r()(".files .diff-file");t.each((function(e,t){r.a.data(t,"singleFileDiff")||r.a.data(t,"singleFileDiff",new ne(t))}));var n=document.getElementById("diffs");(!n||n&&n.dataset&&""!==n.dataset.isLocked)&&d.init(t);var i=r()(".files").first().get(0),a=i&&i.hasAttribute("data-can-create-note");t.each((function(e,t){return X.initImageDiff(t,a)})),oe||(r()(document).on("click",".js-unfold",this.handleClickUnfold.bind(this)).on("click",".diff-line-num a",this.handleClickLineNum.bind(this)).on("mousedown","td.line_content.parallel",this.handleParallelLineDown.bind(this)),oe=!0),Object(c.e)()&&this.highlightSelectedLine(),this.openAnchoredDiff()}var t,n,i;return t=e,(n=[{key:"handleClickUnfold",value:function(e){var t,n,i=r()(e.target),c=ie(this.lineNumbers(i.parent()),2),l=c[0],u=c[1],f=u-l,d=i.hasClass("js-unfold-bottom"),h=!0;if(d){var g=u+1;t=g,n=g+20}else{var m=u-1;t=m-20,n=m;var p=this.lineNumbers(i.parent().prev())[1];t<=p+1&&(t=p+1,h=!1)}var v=i.parents(".diff-file"),b=v.data("blobDiffPath"),y={since:t,to:n,bottom:d,offset:f,unfold:h,view:v.data("view")};a.a.get(b,{params:y}).then((function(e){var t=e.data;return i.parent().replaceWith(t)})).catch((function(){return Object(o.a)(Object(s.a)("An error occurred while loading diff"))}))}},{key:"openAnchoredDiff",value:function(e){var t=this,n=Object(c.e)(),i=n&&n.split("_")[0];if(i){var a=r()("#".concat(i)).closest(".diff-file");if(r()(".nothing-here-block:visible",a).length){var o=r()(".js-file-title, .click-to-expand",a);a.data("singleFileDiff").toggleDiff(o,(function(){t.highlightSelectedLine(),e&&e()}))}else e&&e()}}},{key:"handleClickLineNum",value:function(e){var t=r()(e.currentTarget).attr("href");e.preventDefault(),window.history.pushState?window.history.pushState(null,null,t):window.location.hash=t,this.highlightSelectedLine()}},{key:"handleParallelLineDown",value:function(e){var t=r()(e.currentTarget),n=t.closest("table");n.removeClass("left-side-selected right-side-selected");var i=["left-side","right-side"].filter((function(e){return t.hasClass(e)}))[0];i&&n.addClass("".concat(i,"-selected"))}},{key:"diffViewType",value:function(){return r()(".inline-parallel-buttons a.active").data("viewType")}},{key:"lineNumbers",value:function(e){var t=e.find(".diff-line-num").toArray();return 2!==t.length?[0,0]:t.map((function(e){return parseInt(r()(e).data("linenumber"),10)||0}))}},{key:"highlightSelectedLine",value:function(){var e=Object(c.e)(),t=r()(".diff-file");t.find(".hll").removeClass("hll"),e&&t.find("tr#".concat(e,":not(.match) td, td#").concat(e,', td[data-line-code="').concat(e,'"]')).addClass("hll")}}])&&ae(t.prototype,n),i&&ae(t,i),e}()},T85t:function(e,t,n){var i=n("ZfjD"),r=n("QmHw"),a=n("fGDj").f;i({target:"Object",stat:!0,forced:r((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:a})},arjl:function(e,t,n){var i=n("ZfjD"),r=n("wZF9"),a=n("70tN"),o=n("YEnO"),s=n("MEJ2"),c=n("QDZz");i({target:"Reflect",stat:!0},{get:function e(t,n){var i,l,u=arguments.length<3?t:arguments[2];return a(t)===u?t[n]:(i=s.f(t,n))?o(i,"value")?i.value:void 0===i.get?void 0:i.get.call(u):r(l=c(t))?e(l,n,u):void 0}})}}]);
//# sourceMappingURL=commons~pages.projects.commit.show~pages.projects.compare.show~pages.projects.merge_requests.creatio~fa040d32.2e23698c.chunk.js.map