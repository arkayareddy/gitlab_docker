(this.webpackJsonp=this.webpackJsonp||[]).push([[35],{"53m/":function(e,t,n){(function(t){window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,n){var i,o,s,a,r=[].indexOf;i=function(e){return Array.prototype.slice.apply(e)},s=function(e,t){for(;e&&!e.classList.contains(t);)e=e.parentNode;return e},a=function(e,t){var n;return"function"==typeof Event?(n=new Event(e,{bubbles:!0,cancelable:!0})).detail=t:(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),n},o=function(){class e{constructor(e){this.el=e,this.container=s(this.el,"js-task-list-container"),this.field=this.container.querySelector(".js-task-list-field"),this.container.addEventListener("change",e=>{if(e.target.classList.contains("task-list-item-checkbox"))return this.updateTaskList(e.target)}),this.enable()}enable(){var e;if(this.container.querySelectorAll(".js-task-list-field").length>0)return i(this.container.querySelectorAll(".task-list-item")).forEach((function(e){return e.classList.add("enabled")})),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach((function(e){return e.disabled=!1})),this.container.classList.add("is-task-list-enabled"),e=a("tasklist:enabled"),this.container.dispatchEvent(e)}disable(){var e;return i(this.container.querySelectorAll(".task-list-item")).forEach((function(e){return e.classList.remove("enabled")})),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach((function(e){return e.disabled=!0})),this.container.classList.remove("is-task-list-enabled"),e=a("tasklist:disabled"),this.container.dispatchEvent(e)}updateTaskList(t){var n,o,s,r,l,c,d;if(s=this.container.querySelectorAll(".task-list-item-checkbox"),r=1+i(s).indexOf(t),n=a("tasklist:change",{index:r,checked:t.checked}),this.field.dispatchEvent(n),!n.defaultPrevented)return({result:d,lineNumber:l,lineSource:c}=e.updateSource(this.field.value,r,t.checked,t)),this.field.value=d,n=a("change"),this.field.dispatchEvent(n),o=a("tasklist:changed",{index:r,checked:t.checked,lineNumber:l,lineSource:c}),this.field.dispatchEvent(o)}static escapePattern(e){return e.replace(/([\[\]])/g,"\\$1").replace(/\s/,"\\s").replace("x","[xX]")}static updateSource(e,t,n,i){return i.parentElement.hasAttribute("data-sourcepos")?this._updateSourcePosition(e,i,n):this._updateSourceRegex(e,t,n)}static _updateSourcePosition(e,t,n){var i,o,s,a,r;return a=e.split("\n"),r=t.parentElement.getAttribute("data-sourcepos"),s=a[(o=parseInt(r.split(":")[0]))-1],i=n?s.replace(this.incompletePattern,this.complete):s.replace(this.completePattern,this.incomplete),a[o-1]=i,{result:a.join("\n"),lineNumber:o,lineSource:s}}static _updateSourceRegex(e,t,n){var i,o,s,a,l,c,d,u;return u=e.split("\n"),i=e.replace(/\r/g,"").replace(this.itemsInParasPattern,"").split("\n"),a=0,s=!1,{result:function(){var e,f,h;for(h=[],o=e=0,f=u.length;e<f;o=++e)l=u[o],s?l.match(this.endFencesPattern)&&(s=!1):l.match(this.startFencesPattern)?s=!0:r.call(i,l)>=0&&l.trim().match(this.itemPattern)&&(a+=1)===t&&(c=o+1,d=l,l=n?l.replace(this.incompletePattern,this.complete):l.replace(this.completePattern,this.incomplete)),h.push(l);return h}.call(this).join("\n"),lineNumber:c,lineSource:d}}}return e.incomplete="[ ]",e.complete="[x]",e.incompletePattern=RegExp(`${e.escapePattern(e.incomplete)}`),e.completePattern=RegExp(`${e.escapePattern(e.complete)}`),e.itemPattern=RegExp(`^(?:\\s*(?:>\\s*)*(?:[-+*]|(?:\\d+\\.)))\\s*(${e.escapePattern(e.complete)}|${e.escapePattern(e.incomplete)})\\s`),e.startFencesPattern=/^`{3}.*$/,e.endFencesPattern=/^`{3}$/,e.itemsInParasPattern=RegExp(`^(${e.escapePattern(e.complete)}|${e.escapePattern(e.incomplete)}).+$`,"g"),e}.call(this),void 0!==t&&(t.fn.taskList=function(e){return this.each((function(n,i){var s;if((s=t(i).data("task-list"))||(s=new o(i),t(i).data("task-list",s),e&&"enable"!==e))return s[e||"enable"]()}))}),e.exports=o}])}).call(this,n("3a3M"))},QBXl:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("va8A"),n("z4I3"),n("dj/k"),n("x/6R"),n("gyUR"),n("MRnW"),n("tbvx"),n("orcL");var i=n("3a3M"),o=n.n(i),s=(n("53m/"),n("/lV4")),a=n("2ibD"),r=n("XRO8");function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector,this.dataType=t.dataType,this.fieldName=t.fieldName,this.lockVersion=t.lockVersion,this.taskListContainerSelector="".concat(this.selector," .js-task-list-container"),this.updateHandler=this.update.bind(this),this.onSuccess=t.onSuccess||function(){},this.onError=t.onError||function(e){var t="";return e.response.data&&"object"===c(e.response.data)&&(t=e.response.data.errors.join(" ")),new r.a(t||Object(s.a)("Update failed"),"alert")},this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.disable(),o()(this.taskListContainerSelector).taskList("enable"),o()(document).on("tasklist:changed",this.taskListContainerSelector,this.updateHandler)}},{key:"getTaskListTarget",value:function(e){return e&&e.currentTarget?o()(e.currentTarget):o()(this.taskListContainerSelector)}},{key:"disableTaskListItems",value:function(e){this.getTaskListTarget(e).taskList("disable")}},{key:"enableTaskListItems",value:function(e){this.getTaskListTarget(e).taskList("enable")}},{key:"disable",value:function(){this.disableTaskListItems(),o()(document).off("tasklist:changed",this.taskListContainerSelector)}},{key:"update",value:function(e){var t,n=this,i=o()(e.target),s=e.detail,r=s.index,c=s.checked,d=s.lineNumber,u=s.lineSource,f={};return f[this.dataType]=(l(t={},this.fieldName,i.val()),l(t,"lock_version",this.lockVersion),l(t,"update_task",{index:r,checked:c,line_number:d,line_source:u}),t),this.disableTaskListItems(e),a.a.patch(i.data("updateUrl")||o()("form.js-issuable-update").attr("action"),f).then((function(t){var i=t.data;return n.lockVersion=i.lock_version,n.enableTaskListItems(e),n.onSuccess(i)})).catch((function(t){var i=t.response;return n.enableTaskListItems(e),n.onError(i.data)}))}}])&&d(t.prototype,n),i&&d(t,i),e}()},d5X7:function(e,t,n){"use strict";n("+kFb"),n("Id6h");var i={init:function(e){this.hook=e,this.destroyed=!1,this.config=e.config.InputSetter||(this.hook.config.InputSetter={}),this.eventWrapper={},this.addEvents()},addEvents:function(){this.eventWrapper.setInputs=this.setInputs.bind(this),this.hook.list.list.addEventListener("click.dl",this.eventWrapper.setInputs)},removeEvents:function(){this.hook.list.list.removeEventListener("click.dl",this.eventWrapper.setInputs)},setInputs:function(e){var t=this;if(!this.destroyed){var n=e.detail.selected;Array.isArray(this.config)||(this.config=[this.config]),this.config.forEach((function(e){return t.setInput(e,n)}))}},setInput:function(e,t){var n=e.input||this.hook.trigger,i=t.getAttribute(e.valueAttribute),o=e.inputAttribute;return n.hasAttribute(o)?n.setAttribute(o,i):"INPUT"===n.tagName?n.value=i:n.textContent=i},destroy:function(){this.destroyed=!0,this.removeEvents()}};t.a=i},tRCE:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n("gyUR");var i=n("n7CP");function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t,n,o,s){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.field=t,this.isLocalStorageAvailable=i.a.isLocalStorageAccessSafe(),null!=n.join&&(n=n.join("/")),this.key="autosave/".concat(n),this.fallbackKey=o,this.lockVersionKey="".concat(this.key,"/lockVersion"),this.lockVersion=s,this.field.data("autosave",this),this.restore(),this.field.on("input",(function(){return a.save()}))}var t,n,s;return t=e,(n=[{key:"restore",value:function(){if(this.isLocalStorageAvailable&&this.field.length){var e=window.localStorage.getItem(this.key),t=window.localStorage.getItem(this.fallbackKey);e?this.field.val(e):t&&this.field.val(t),this.field.trigger("input");var n=new Event("change",{bubbles:!0,cancelable:!1}),i=this.field.get(0);i&&i.dispatchEvent(n)}}},{key:"getSavedLockVersion",value:function(){if(this.isLocalStorageAvailable)return window.localStorage.getItem(this.lockVersionKey)}},{key:"save",value:function(){if(this.field.length){var e=this.field.val();return this.isLocalStorageAvailable&&e?(this.fallbackKey&&window.localStorage.setItem(this.fallbackKey,e),void 0!==this.lockVersion&&window.localStorage.setItem(this.lockVersionKey,this.lockVersion),window.localStorage.setItem(this.key,e)):this.reset()}}},{key:"reset",value:function(){if(this.isLocalStorageAvailable)return window.localStorage.removeItem(this.lockVersionKey),window.localStorage.removeItem(this.fallbackKey),window.localStorage.removeItem(this.key)}},{key:"dispose",value:function(){this.field.off("input")}}])&&o(t.prototype,n),s&&o(t,s),e}()},uqFy:function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));n("va8A"),n("z4I3"),n("9U97"),n("kO4A"),n("t3Gg"),n("gyUR"),n("8Qi2"),n("BD5p"),n("MRnW"),n("jaBk"),n("EfZm"),n("Ag57"),n("IdsT"),n("GzNv"),n("S26F"),n("pBsb"),n("+xeR");var i=n("o4PY"),o=n.n(i),s=n("G3fq"),a=n.n(s),r=n("3a3M"),l=n.n(r),c=n("06tH"),d=n.n(c),u=n("k5du"),f=n.n(u),h=(n("6IOw"),n("OmYI"),n("jB52")),m=n("TBBL"),p=n("Gs6c"),v=n("FYnm"),g=n("2ibD"),y=n("3twG"),b=n("XRO8"),k=n("Jn9D"),w=(n("+kFb"),n("zCcL"),n("zpLX"),n("Id6h"),n("Naob"));function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n("d5X7").a),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dropdownTrigger=t.dropdownTrigger,this.dropdownList=t.dropdownList,this.noteTypeInput=t.noteTypeInput,this.submitButton=t.submitButton,this.closeButton=t.closeButton,this.reopenButton=t.reopenButton}var t,n,i;return t=e,(n=[{key:"initDroplab",value:function(){this.droplab=new w.a;var e=this.setConfig();this.droplab.init(this.dropdownTrigger,this.dropdownList,[N],e)}},{key:"setConfig",value:function(){var e={InputSetter:[{input:this.noteTypeInput,valueAttribute:"data-value"},{input:this.submitButton,valueAttribute:"data-submit-text"}]};return this.closeButton&&e.InputSetter.push({input:this.closeButton,valueAttribute:"data-close-text"},{input:this.closeButton,valueAttribute:"data-close-text",inputAttribute:"data-alternative-text"}),this.reopenButton&&e.InputSetter.push({input:this.reopenButton,valueAttribute:"data-reopen-text"},{input:this.reopenButton,valueAttribute:"data-reopen-text",inputAttribute:"data-alternative-text"}),e}}])&&j(t.prototype,n),i&&j(t,i),e}(),x=n("FVJN"),T=n("/ode"),S=n("tRCE"),A=n("QBXl"),D=n("NmEs"),F=n("bOix"),I=n("/lV4");function P(e,t,n){return(P=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&L(o,n.prototype),o}).apply(null,arguments)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),e}function B(e){return e.replace(/\r\n/g,"\n")}window.autosize=f.a;var R=/^\/\w+.*$/gm,M=function(){function e(t,n,i,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:k.b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateTargetButtons=this.updateTargetButtons.bind(this),this.updateComment=this.updateComment.bind(this),this.visibilityChange=this.visibilityChange.bind(this),this.cancelDiscussionForm=this.cancelDiscussionForm.bind(this),this.onAddDiffNote=this.onAddDiffNote.bind(this),this.onAddImageDiffNote=this.onAddImageDiffNote.bind(this),this.setupDiscussionNoteForm=this.setupDiscussionNoteForm.bind(this),this.onReplyToDiscussionNote=this.onReplyToDiscussionNote.bind(this),this.removeNote=this.removeNote.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.updateNote=this.updateNote.bind(this),this.addDiscussionNote=this.addDiscussionNote.bind(this),this.addNoteError=this.addNoteError.bind(this),this.addNote=this.addNote.bind(this),this.resetMainTargetForm=this.resetMainTargetForm.bind(this),this.refresh=this.refresh.bind(this),this.keydownNoteText=this.keydownNoteText.bind(this),this.toggleCommitList=this.toggleCommitList.bind(this),this.postComment=this.postComment.bind(this),this.clearFlashWrapper=this.clearFlash.bind(this),this.onHashChange=this.onHashChange.bind(this),this.notes_url=t,this.note_ids=n,this.enableGFM=s,this.updatedNotesTrackingMap={},this.last_fetched_at=i,this.noteable_url=document.URL,this.notesCountBadge||(this.notesCountBadge=l()(".issuable-details").find(".notes-tab .badge")),this.basePollingInterval=15e3,this.maxPollingSteps=4,this.$wrapperEl=Object(D.z)()?l()(document).find(".diffs"):l()(document),this.cleanBinding(),this.addBinding(),this.setPollingInterval(),this.setupMainTargetNoteForm(s),this.taskList=new A.a({dataType:"note",fieldName:"note",selector:".notes"}),this.collapseLongCommitList(),this.setViewType(o),"merge_requests"===Object(D.n)(1)&&l()(".note-edit-form").clone().addClass("mr-note-edit-form").insertAfter(".note-edit-form");var a=Object(y.e)(),r=a&&document.getElementById(a);r&&this.loadLazyDiff({currentTarget:r})}return $(e,null,[{key:"initialize",value:function(t,n,i,o,s){this.instance||(this.instance=new e(t,n,i,o,s))}},{key:"getInstance",value:function(){return this.instance}}]),$(e,[{key:"setViewType",value:function(e){this.view=d.a.get("diff_view")||e}},{key:"addBinding",value:function(){this.$wrapperEl.on("click",".js-note-edit",this.showEditForm.bind(this)),this.$wrapperEl.on("click",".note-edit-cancel",this.cancelEdit),this.$wrapperEl.on("click",".js-comment-submit-button",this.postComment),this.$wrapperEl.on("click",".js-comment-save-button",this.updateComment),this.$wrapperEl.on("keyup input",".js-note-text",this.updateTargetButtons),this.$wrapperEl.on("click",".js-comment-resolve-button",this.postComment),this.$wrapperEl.on("click",".js-note-delete",this.removeNote),this.$wrapperEl.on("click",".js-note-attachment-delete",this.removeAttachment),this.$wrapperEl.on("change",".js-note-attachment-input",this.updateFormAttachment),this.$wrapperEl.on("click",".js-discussion-reply-button",this.onReplyToDiscussionNote),this.$wrapperEl.on("click",".js-add-diff-note-button",this.onAddDiffNote),this.$wrapperEl.on("click",".js-add-image-diff-note-button",this.onAddImageDiffNote),this.$wrapperEl.on("click",".js-close-discussion-note-form",this.cancelDiscussionForm),this.$wrapperEl.on("click",".system-note-commit-list-toggler",this.toggleCommitList),this.$wrapperEl.on("click",".js-toggle-lazy-diff",this.loadLazyDiff),this.$wrapperEl.on("click",".js-toggle-lazy-diff-retry-button",this.onClickRetryLazyLoad.bind(this)),this.$wrapperEl.on("visibilitychange",this.visibilityChange),this.$wrapperEl.on("issuable:change",this.refresh),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.addNote),this.$wrapperEl.on("ajax:success",".js-discussion-note-form",this.addDiscussionNote),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.resetMainTargetForm),this.$wrapperEl.on("ajax:complete",".js-main-target-form",this.reenableTargetFormSubmitButton),this.$wrapperEl.on("keydown",".js-note-text",this.keydownNoteText),l()(window).on("hashchange",this.onHashChange)}},{key:"cleanBinding",value:function(){this.$wrapperEl.off("click",".js-note-edit"),this.$wrapperEl.off("click",".note-edit-cancel"),this.$wrapperEl.off("click",".js-note-delete"),this.$wrapperEl.off("click",".js-note-attachment-delete"),this.$wrapperEl.off("click",".js-discussion-reply-button"),this.$wrapperEl.off("click",".js-add-diff-note-button"),this.$wrapperEl.off("click",".js-add-image-diff-note-button"),this.$wrapperEl.off("visibilitychange"),this.$wrapperEl.off("keyup input",".js-note-text"),this.$wrapperEl.off("click",".js-note-target-reopen"),this.$wrapperEl.off("click",".js-note-target-close"),this.$wrapperEl.off("keydown",".js-note-text"),this.$wrapperEl.off("click",".js-comment-resolve-button"),this.$wrapperEl.off("click",".system-note-commit-list-toggler"),this.$wrapperEl.off("click",".js-toggle-lazy-diff"),this.$wrapperEl.off("click",".js-toggle-lazy-diff-retry-button"),this.$wrapperEl.off("ajax:success",".js-main-target-form"),this.$wrapperEl.off("ajax:success",".js-discussion-note-form"),this.$wrapperEl.off("ajax:complete",".js-main-target-form"),l()(window).off("hashchange",this.onHashChange)}},{key:"keydownNoteText",value:function(e){var t,n,i;if(!Object(D.D)(e)){var o=l()(e.target);switch(e.which){case 38:if(""!==o.val())return;if((i=l()("li.note[data-author-id='".concat(gon.current_user_id,"'][data-editable]:last"),o.closest(".note, .notes_holder, #notes"))).length)return i.find(".js-note-edit").trigger("click",[!0,i]);break;case 27:if((t=o.closest(".js-discussion-note-form")).length){if(""!==o.val()&&!window.confirm(Object(I.a)("Your comment will be discarded.")))return;return void this.removeDiscussionNoteForm(t)}if((n=o.closest(".note")).length){if(o.closest("form").data("originalNote")!==o.val()&&!window.confirm(Object(I.a)("Are you sure you want to discard this comment?")))return;return this.removeNoteEditForm(n)}}}}},{key:"initRefresh",value:function(){var t=this;e.interval&&clearInterval(e.interval),e.interval=setInterval((function(){return t.refresh()}),this.pollingInterval)}},{key:"refresh",value:function(){if(!document.hidden)return this.getContent()}},{key:"getContent",value:function(){var e=this;this.refreshing||(this.refreshing=!0,g.a.get("".concat(this.notes_url,"?html=true"),{headers:{"X-Last-Fetched-At":this.last_fetched_at}}).then((function(t){var n=t.data,i=n.notes;e.last_fetched_at=n.last_fetched_at,e.setPollingInterval(n.notes.length),l.a.each(i,(function(t,n){return e.renderNote(n)})),e.refreshing=!1})).catch((function(){e.refreshing=!1})))}},{key:"setPollingInterval",value:function(e){null==e&&(e=!0);var t=this.basePollingInterval*Math.pow(2,this.maxPollingSteps-1);return e?this.pollingInterval=this.basePollingInterval:this.pollingInterval<t&&(this.pollingInterval*=2),this.initRefresh()}},{key:"handleQuickActions",value:function(t){var n;t.commands_changes&&("merge"in t.commands_changes&&e.checkMergeRequestStatus(),"emoji_award"in t.commands_changes&&(n=l()(".js-awards-block").eq(0),Object(T.b)().then((function(e){e.addAwardToEmojiBar(n,t.commands_changes.emoji_award),e.scrollToAwards()})).catch((function(){}))))}},{key:"setupNewNote",value:function(t){Object(F.m)(t.find(".js-timeago"),!1),this.collapseLongCommitList(),this.taskList.init(),e.updateNoteTargetSelector(t),this.$noteToCleanHighlight=t}},{key:"onHashChange",value:function(){this.$noteToCleanHighlight&&e.updateNoteTargetSelector(this.$noteToCleanHighlight),this.$noteToCleanHighlight=null}},{key:"renderNote",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l()(".main-notes-list");if(t.discussion_html)return this.renderDiscussionNote(t,n);if(t.valid){var o=i.find("#note_".concat(t.id));if(e.isNewNote(t,this.note_ids)){if(Object(D.z)())return;this.note_ids.push(t.id),i.length&&i.find(".system-note.being-posted").remove();var s=e.animateAppendNote(t.html,i);return this.setupNewNote(s),this.refresh(),this.updateNotesCount(1)}if(e.isUpdatedNote(t,o)){var a=o.hasClass("is-editing"),r=B(o.find(".original-note-content").text().trim()),c=o.find(".js-note-text"),d=c.val(),u=B(t.note),f=d===r||d===u;if(a&&f)c.val(t.note),this.updatedNotesTrackingMap[t.id]=t;else if(a&&!f)this.putConflictEditWarningInPlace(t,o),this.updatedNotesTrackingMap[t.id]=t;else{var h=e.animateUpdateNote(t.html,o);this.setupNewNote(h)}}}else t.errors&&t.errors.commands_only&&(t.commands_changes&&Object.keys(t.commands_changes).length>0&&i.find(".system-note.being-posted").remove(),this.addFlash(t.errors.commands_only,"notice",this.parentTimeline.get(0)),this.refresh())}},{key:"isParallelView",value:function(){return"parallel"===d.a.get("diff_view")}},{key:"renderDiscussionNote",value:function(t,n){var i,o;if(e.isNewNote(t,this.note_ids)){this.note_ids.push(t.id);var s=n||l()('.js-discussion-note-form[data-discussion-id="'.concat(t.discussion_id,'"]'));o=s.length||!t.discussion_line_code?s.closest("tr"):l()("#".concat(t.discussion_line_code)),t.on_image&&(o=s);var a=this.isParallelView()?s.find("#line_type").val():"old",r=o.prevAll(".line_holder").first().find(".js-avatar-container.".concat(a,"_line"));if((i=l()('.notes[data-discussion-id="'.concat(t.discussion_id,'"]'))).length||(i=s.closest(".discussion").find(".notes")),0===i.length)if(t.diff_discussion_html){var c=l()(t.diff_discussion_html).renderGFM();if(!this.isParallelView()||o.hasClass("js-temp-notes-holder")||t.on_image)o.after(c);else{var d=c.find('.notes[data-discussion-id="'.concat(t.discussion_id,'"]')),u=d.closest(".notes-content").attr("class").split(" ").join(".");o.find(".".concat(u," .content")).append(d.closest(".content").children())}}else e.animateAppendNote(t.discussion_html,l()(".main-notes-list"));else e.animateAppendNote(t.html,i);return void 0!==gl.diffNotesCompileComponents&&t.discussion_resolvable&&(gl.diffNotesCompileComponents(),this.renderDiscussionAvatar(r,t)),Object(F.m)(l()(".js-timeago"),!1),e.checkMergeRequestStatus(),this.updateNotesCount(1)}}},{key:"getLineHolder",value:function(e){return l()(e).closest(".notes_holder").prevAll(".line_holder").first().get(0)}},{key:"renderDiscussionAvatar",value:function(e,t){var n=e.find(".diff-comment-avatar-holders");n.length||((n=document.createElement("diff-note-avatars")).setAttribute("discussion-id",t.discussion_id),e.append(n),gl.diffNotesCompileComponents())}},{key:"resetMainTargetForm",value:function(e){var t=l()(".js-main-target-form");t.find(".js-errors").remove(),t.find(".js-md-write-button").click(),t.find(".js-note-text").val("").trigger("input"),t.find(".js-note-text").data("autosave").reset();var n=document.createEvent("Event");n.initEvent("autosize:update",!0,!1),t.find(".js-autosize")[0].dispatchEvent(n),this.updateTargetButtons(e)}},{key:"reenableTargetFormSubmitButton",value:function(){return l()(".js-main-target-form").find(".js-note-text").trigger("input")}},{key:"setupMainTargetNoteForm",value:function(t){var n=l()(".js-new-note-form");this.formClone=n.clone(),this.setupNoteForm(n,t),n.removeClass("js-new-note-form"),n.addClass("js-main-target-form"),n.find("#note_line_code").remove(),n.find("#note_position").remove(),n.find("#note_type").val(""),n.find("#note_project_id").remove(),n.find("#in_reply_to_discussion_id").remove(),n.find(".js-comment-resolve-button").closest("comment-and-resolve-btn").remove(),this.parentTimeline=n.parents(".timeline"),n.length&&e.initCommentTypeToggle(n.get(0))}},{key:"setupNoteForm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.b;this.glForm=new x.a(e,t);var n=e.find(".js-note-text"),i=[Object(I.d)("NoteForm|Note"),e.find("#note_noteable_type").val(),e.find("#note_noteable_id").val(),e.find("#note_commit_id").val(),e.find("#note_type").val(),e.find("#note_project_id").val(),e.find("#in_reply_to_discussion_id").val(),e.find("#note_line_code").val(),e.find("#note_position").val()];return new S.a(n,i)}},{key:"addNote",value:function(e,t){return this.renderNote(t)}},{key:"addNoteError",value:function(e){var t;return e.hasClass("js-main-target-form")?t=e.parents(".timeline"):e.hasClass("js-discussion-note-form")&&(t=e.closest(".discussion-notes").find(".notes")),this.addFlash(Object(I.a)("Your comment could not be submitted! Please check your network connection and try again."),"alert",t.get(0))}},{key:"updateNoteError",value:function(){new b.a(Object(I.a)("Your comment could not be updated! Please check your network connection and try again."))}},{key:"addDiscussionNote",value:function(e,t,n){if(null!=e.attr("data-resolve-all")){var i=e.data("discussionId"),o=e.data("noteableIid");null!=ResolveService&&ResolveService.toggleResolveForDiscussion(o,i)}this.renderNote(t,e),n&&this.removeDiscussionNoteForm(e)}},{key:"updateNote",value:function(e,t){var n=l()(e.html);this.revertNoteEditForm(t),n.renderGFM(),l()(".note-row-".concat(e.id)).replaceWith(n),this.setupNewNote(n),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"checkContentToAllowEditing",value:function(e){var t=e.find(".original-note-content").text().trim(),n=!0;e.find(".js-note-text").val()===t?this.removeNoteEditForm(e):(Object(D.B)(e.get(0))||Object(D.Q)(e),e.find(".js-finish-edit-warning").show(),n=!1);return n}},{key:"showEditForm",value:function(e){e.preventDefault();var t=l()(e.target),n=l()(this.getEditFormSelector(t)),i=t.closest(".note"),o=l()(".note.is-editing:visible");if(o.length&&!this.checkContentToAllowEditing(o))return;i.find(".js-note-attachment-delete").show(),n.addClass("current-note-edit-form"),i.addClass("is-editing"),this.putEditFormInPlace(t)}},{key:"cancelEdit",value:function(e){e.preventDefault();var t=l()(e.target),n=t.closest(".note"),i=n.attr("data-note-id");if(this.revertNoteEditForm(t),this.updatedNotesTrackingMap[i]){var o=l()(this.updatedNotesTrackingMap[i].html);n.replaceWith(o),this.setupNewNote(o),delete this.updatedNotesTrackingMap[i]}else n.find(".js-finish-edit-warning").hide(),this.removeNoteEditForm(n)}},{key:"revertNoteEditForm",value:function(e){e=e||l()(".note.is-editing:visible");var t=this.getEditFormSelector(e),n=l()(t);n.insertBefore(".diffs"),n.find(".js-comment-save-button").enable(),n.find(".js-finish-edit-warning").hide()}},{key:"getEditFormSelector",value:function(e){var t=".note-edit-form:not(.mr-note-edit-form)";return e.parents("#diffs").length&&(t=".note-edit-form.mr-note-edit-form"),t}},{key:"removeNoteEditForm",value:function(e){var t=e.find(".diffs .current-note-edit-form");return e.removeClass("is-editing"),t.removeClass("current-note-edit-form"),t.find(".js-finish-edit-warning").hide(),t.find(".js-note-text").val(t.find("form.edit-note").data("originalNote"))}},{key:"removeNote",value:function(t){var n=l()(t.currentTarget).closest(".note").attr("id");return l()('.note[id="'.concat(n,'"]')).each((function(e,t){var i=l()(t),o=i.closest(".discussion-notes"),s=l()(".notes",o).data("discussionId");if(void 0!==gl.diffNotesCompileComponents&&gl.diffNoteApps[n]&&gl.diffNoteApps[n].$destroy(),i.remove(),0===o.find(".note").length){var a=o.closest("tr");if(o.closest(".timeline-entry").remove(),l()(".js-diff-avatars-".concat(s)).trigger("remove.vue"),a.find(".discussion-notes").length>1||0===a.length){var r=o.closest(".diff-file");if(r.length>0){var c=new CustomEvent("removeBadge.imageDiff",{detail:{badgeNumber:o.index()+1}});r[0].dispatchEvent(c)}o.remove()}else a.length>0&&a.remove()}})),e.checkMergeRequestStatus(),this.updateNotesCount(-1)}},{key:"removeAttachment",value:function(){var e=l()(this).closest(".note");return e.find(".note-attachment").remove(),e.find(".note-body > .note-text").show(),e.find(".note-header").show(),e.find(".diffs .current-note-edit-form").remove()}},{key:"onReplyToDiscussionNote",value:function(e){this.replyToDiscussionNote(e.target)}},{key:"replyToDiscussionNote",value:function(e){var t=this.cleanForm(this.formClone.clone()),n=l()(e).closest(".js-discussion-reply-button");return n.closest(".discussion-reply-holder").hide().after(t),this.setupDiscussionNoteForm(n,t)}},{key:"setupDiscussionNoteForm",value:function(e,t){var n=e.closest(".text-file");0===n.length&&(n=e.closest(".image"));var i=e.data("discussionId");(i&&(t.attr("data-discussion-id",i),t.find("#in_reply_to_discussion_id").val(i)),t.find("#note_project_id").val(e.data("discussionProjectId")),t.attr("data-line-code",e.data("lineCode")),t.find("#line_type").val(e.data("lineType")),t.find("#note_noteable_type").val(n.data("noteableType")),t.find("#note_noteable_id").val(n.data("noteableId")),t.find("#note_commit_id").val(n.data("commitId")),t.find("#note_type").val(e.data("noteType")),t.find("#note_line_code").val(e.data("lineCode")),t.find("#note_position").val(e.attr("data-position")),t.prepend('<a href="'.concat(a()(gon.current_username),'" class="user-avatar-link d-none d-sm-block"><img class="avatar s40" src="').concat(encodeURI(gon.current_user_avatar_url||gon.default_avatar_url),'" alt="').concat(a()(gon.current_user_fullname),'" /></a>')).append("</div>").find(".js-close-discussion-note-form").show().removeClass("hide"),t.find(".js-note-target-close").remove(),t.find(".js-note-new-discussion").remove(),this.setupNoteForm(t),t.removeClass("js-main-target-form").addClass("discussion-form js-discussion-note-form"),void 0!==gl.diffNotesCompileComponents)&&(t.find("comment-and-resolve-btn").attr(":discussion-id","'".concat(i,"'")),gl.diffNotesCompileComponents());t.find(".js-note-text").focus(),t.find(".js-comment-resolve-button").attr("data-discussion-id",i)}},{key:"onAddDiffNote",value:function(e){e.preventDefault();var t=e.currentTarget||e.target,n=l()(t),i=!n.hasClass("js-diff-comment-avatar");this.toggleDiffNote({target:n,lineType:t.dataset.lineType,showReplyInput:i,currentUsername:gon.current_username,currentUserAvatar:gon.current_user_avatar_url,currentUserFullname:gon.current_user_fullname})}},{key:"onAddImageDiffNote",value:function(e){var t,n=l()(e.currentTarget||e.target),i=n.closest(".diff-file"),o=new CustomEvent("click.imageDiff",{detail:e});i[0].dispatchEvent(o);var s=n.closest(".diff-viewer").find(".note-container"),a=s.find("> .discussion-form");0===a.length?(t=this.cleanForm(this.formClone.clone())).appendTo(s):t=a,this.setupDiscussionNoteForm(n,t)}},{key:"toggleDiffNote",value:function(e){var t,n,i,o,s=e.target,a=e.lineType,r=e.forceShow,c=e.showReplyInput,d=void 0!==c&&c,u=l()(s),f=u.closest("tr"),h=f.next(),m=f;h.is(".notes_holder")&&(m=h);var p=h.is(".notes_holder");t=!1;var v="";o='<tr class="notes_holder js-temp-notes-holder"><td class="notes-content" colspan="3"><div class="content"></div></td></tr>',this.isParallelView()&&(v=".".concat(a),o='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line old"></td><td class="notes-content parallel old"><div class="content"></div></td><td class="notes_line new"></td><td class="notes-content parallel new"><div class="content"></div></td></tr>');var g=".notes-content".concat(v," .content"),y=m.find(g);if(p&&d)m.show(),(y=m.find(g)).length&&(y.show(),(i=y.find(".js-discussion-reply-button:visible")).length?this.replyToDiscussionNote(i[0]):0===y.find(".js-discussion-note-form").length&&(t=!0));else if(d)f.after(o),y=(m=f.next()).find(g),t=!0;else{var b=m.find(".content:not(:empty)").is(":visible"),k=!0===r||!b&&!(!0===r||!1===r);m.toggleClass("hide",!k),y.toggleClass("hide",!k)}if(t)return(n=this.cleanForm(this.formClone.clone())).appendTo(y),this.setupDiscussionNoteForm(u,n)}},{key:"removeDiscussionNoteForm",value:function(e){var t=e.closest("tr");return e.data("glForm").destroy(),e.find(".js-note-text").data("autosave").reset(),e.prev(".discussion-reply-holder").show(),t.is(".js-temp-notes-holder")?t.remove():e.remove()}},{key:"cancelDiscussionForm",value:function(e){e.preventDefault();var t=l()(e.target).closest(".js-discussion-note-form");if(0===l()(e.target).closest(".discussion-notes").length){var n=t.closest(".diff-file");if(n.length>0){var i=new CustomEvent("blur.imageDiff",{detail:e});n[0].dispatchEvent(i)}}return this.removeDiscussionNoteForm(t)}},{key:"updateFormAttachment",value:function(){var e=l()(this).closest("form"),t=l()(this).val().replace(/^.*[\\\/]/,"");return e.find(".js-attachment-filename").text(t)}},{key:"visibilityChange",value:function(){return this.refresh()}},{key:"updateTargetButtons",value:function(e){var t,n,i=l()(e.target),o=i.parents("form"),s=o.find(".js-note-target-reopen"),a=o.find(".js-note-target-close");i.val().trim().length>0?(n=s.attr("data-alternative-text"),t=a.attr("data-alternative-text"),s.text()!==n&&s.text(n),a.text()!==t&&a.text(t),s.is(":not(.btn-comment-and-reopen)")&&s.addClass("btn-comment-and-reopen"),a.is(":not(.btn-comment-and-close)")&&a.addClass("btn-comment-and-close")):(n=s.data("originalText"),t=a.data("originalText"),s.text()!==n&&s.text(n),a.text()!==t&&a.text(t),s.is(".btn-comment-and-reopen")&&s.removeClass("btn-comment-and-reopen"),a.is(".btn-comment-and-close")&&a.removeClass("btn-comment-and-close"))}},{key:"putEditFormInPlace",value:function(e){var t=l()(this.getEditFormSelector(e)),n=e.closest(".note");t.insertAfter(n.find(".note-text"));var i=n.find(".original-note-content"),o=i.text().trim(),s=i.data("postUrl"),a=i.data("targetId"),r=i.data("targetType");this.glForm=new x.a(t.find("form"),this.enableGFM),t.find("form").attr("action","".concat(s,"?html=true")).attr("data-remote","true"),t.find(".js-form-target-id").val(a),t.find(".js-form-target-type").val(r),t.find(".js-note-text").focus().val(o),t.find(".js-md-write-button").trigger("click"),t.find(".referenced-users").hide()}},{key:"putConflictEditWarningInPlace",value:function(e,t){if(0===t.find(".js-conflict-edit-warning").length){var n='<a href="#note_'.concat(e.id,'" target="_blank" rel="noopener noreferrer">');l()('<div class="js-conflict-edit-warning alert alert-danger">\n        '.concat(Object(I.e)(Object(I.d)("Notes|This comment has changed since you started editing, please review the %{open_link}updated comment%{close_link} to ensure information is not lost"),{open_link:n,close_link:"</a>"}),"\n      </div>")).insertAfter(t.find(".note-text"))}}},{key:"updateNotesCount",value:function(e){return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(),10)+e)}},{key:"onClickRetryLazyLoad",value:function(e){var t=l()(e.currentTarget);return t.prop("disabled",!0),this.loadLazyDiff(e).then((function(){t.prop("disabled",!1)}))}},{key:"loadLazyDiff",value:function(t){var n=l()(t.currentTarget).closest(".js-toggle-container");if(e.renderPlaceholderComponent(n),n.find(".js-toggle-lazy-diff").removeClass("js-toggle-lazy-diff"),0!==n.find("tbody").length){var i=n.find(".file-holder").data("linesPath"),o=n.find(".js-error-lazy-load-diff"),s=n.find(".js-success-lazy-load");return i?g.a.get(i).then((function(t){var i=t.data;s.removeClass("hidden"),o.addClass("hidden"),e.renderDiffContent(n,i)})).catch((function(){s.addClass("hidden"),o.removeClass("hidden")})):Promise.resolve()}}},{key:"toggleCommitList",value:function(e){var t=l()(e.currentTarget),n=t.siblings(".system-note-commit-list");t.find(".fa").toggleClass("fa-angle-down").toggleClass("fa-angle-up"),n.toggleClass("hide-shade")}},{key:"collapseLongCommitList",value:function(){var e=l()("#notes-list").find("li.system-note").has("ul");l.a.each(e,(function(e,t){var n=l()(t),i=n.find(".note-text").find("p").first().text().replace(":","");n.find(".note-header .system-note-message").html(i),n.find("li").length>3?(n.find(".note-text").addClass("system-note-commit-list"),n.find(".system-note-commit-list-toggler").show()):n.find(".note-text").addClass("system-note-commit-list hide-shade")}))}},{key:"addFlash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.flashContainer=P(b.a,t)}},{key:"clearFlash",value:function(){this.flashContainer&&(this.flashContainer.style.display="none",this.flashContainer=null)}},{key:"cleanForm",value:function(e){return e.find(".js-comment-type-dropdown").removeClass("btn-group"),e.find(".dropdown-menu").remove(),e}},{key:"getFormData",value:function(e){var t=e.find(".js-note-text").val();return{formData:e.serialize(),formContent:a()(t),formAction:e.attr("action"),formContentOriginal:t}}},{key:"hasQuickActions",value:function(e){return R.test(e)}},{key:"stripQuickActions",value:function(e){return e.replace(R,"").trim()}},{key:"getQuickActionDescription",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=n.filter((function(t){return new RegExp("/".concat(t.name)).test(e)}));if(i&&i.length)if(i.length>1)t=Object(I.a)("Applying multiple commands");else{var o=i[0].description.toLowerCase();t=Object(I.e)(Object(I.a)("Applying command to %{commandDescription}"),{commandDescription:o})}else t=Object(I.a)("Applying command");return t}},{key:"createPlaceholderNote",value:function(e){var t=e.formContent,n=e.uniqueId,i=e.isDiscussionNote,o=e.currentUsername,s=e.currentUserFullname,r=e.currentUserAvatar,c=i?"discussion":"",d=l()('<li id="'.concat(n,'" class="note being-posted fade-in-half timeline-entry">\n         <div class="timeline-entry-inner">\n            <div class="timeline-icon">\n               <a href="/').concat(a()(o),'">\n                 <img class="avatar s40" src="').concat(r,'" />\n               </a>\n            </div>\n            <div class="timeline-content ').concat(c,'">\n               <div class="note-header">\n                  <div class="note-header-info">\n                     <a href="/').concat(a()(o),'">\n                       <span class="d-none d-sm-inline-block bold">').concat(a()(o),'</span>\n                       <span class="note-headline-light">').concat(a()(o),'</span>\n                     </a>\n                  </div>\n               </div>\n               <div class="note-body">\n                 <div class="note-text">\n                   <p>').concat(t,"</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>"));return d.find(".d-none.d-sm-inline-block").text(a()(s)),d.find(".note-headline-light").text("@".concat(a()(o))),d}},{key:"createPlaceholderSystemNote",value:function(e){var t=e.formContent,n=e.uniqueId;return l()('<li id="'.concat(n,'" class="note system-note timeline-entry being-posted fade-in-half">\n         <div class="timeline-entry-inner">\n           <div class="timeline-content">\n             <i>').concat(t,"</i>\n           </div>\n         </div>\n       </li>"))}},{key:"postComment",value:function(e){var t=this;e.preventDefault();var n=l()(e.target);n.prop("disabled",!0);var i,s,a,r,c=n.parents("form"),d=c.find(".js-note-target-close"),u="discussion"===n.parent().find("li.droplab-item-selected").attr("id"),f=c.hasClass("js-main-target-form"),h=c.hasClass("js-discussion-note-form"),m=n.hasClass("js-comment-resolve-button"),v=this.getFormData(c),y=v.formData,b=v.formContent,k=v.formAction,w=v.formContentOriginal,j=!1;return h?a=c.parent(".discussion-notes").find(".notes"):f&&(a=l()("ul.main-notes-list")),m&&c.find(".js-comment-submit-button").disable(),r=b,this.hasQuickActions(b)&&(r=this.stripQuickActions(b),j=!0),r&&(i=o()("tempNote_"),a.append(this.createPlaceholderNote({formContent:r,uniqueId:i,isDiscussionNote:u,currentUsername:gon.current_username,currentUserFullname:gon.current_user_fullname,currentUserAvatar:gon.current_user_avatar_url}))),j&&(s=o()("tempSystemNote_"),a.append(this.createPlaceholderSystemNote({formContent:this.getQuickActionDescription(b,p.a.get(gl.GfmAutoComplete.dataSources.commands)),uniqueId:s}))),a.length&&(f?this.resetMainTargetForm(e):h&&this.removeDiscussionNoteForm(c)),d.text(d.data("originalText")),g.a.post("".concat(k,"?html=true"),y).then((function(o){var s=o.data;n.prop("disabled",!1),a.find("#".concat(i)).remove();var r=c.closest(".diff-file");if(r.length>0){var l=new CustomEvent("blur.imageDiff",{detail:e});r[0].dispatchEvent(l)}if(j&&c.find("textarea.js-note-text").trigger("clear-commands-cache.atwho"),t.clearFlashWrapper(),h){a.find(".flash-container").remove(),m&&c.attr("data-discussion-id",n.data("discussionId")).attr("data-resolve-all","true").attr("data-project-path",n.data("projectPath"));var d=0===a.length;if(t.addDiscussionNote(c,s,d),d){var u=c.find("#note_position").val();if(r.length>0&&u.length>0){var p=JSON.parse(u),v=p.x,g=p.y,y=p.width,b=p.height,k=new CustomEvent("addBadge.imageDiff",{detail:{x:v,y:g,width:y,height:b,noteId:"note_".concat(s.id),discussionId:s.discussion_id}});r[0].dispatchEvent(k)}}a.length&&a.append('<div class="flash-container" style="display: none;"></div>')}else f&&(t.addNote(c,s),t.reenableTargetFormSubmitButton(e));s.commands_changes&&t.handleQuickActions(s),c.trigger("ajax:success",[s])})).catch((function(){a.find("#".concat(i)).remove(),n.prop("disabled",!1);var o=new CustomEvent("blur.imageDiff",{detail:e}),r=c.closest(".diff-file");if(r.length&&r[0].dispatchEvent(o),j&&a.find("#".concat(s)).remove(),h&&a.length){var l=a.parent().find(".js-discussion-reply-button");t.replyToDiscussionNote(l[0]),c=a.parent().find("form")}c.find(".js-note-text").val(w),t.reenableTargetFormSubmitButton(e),t.addNoteError(c)}))}},{key:"updateComment",value:function(e){var t=this;e.preventDefault();var n=l()(e.target).parents("form"),i=n.find(".js-note-target-close"),o=n.parents(".note.is-editing"),s=o.find(".js-task-list-container").find(".note-text"),r=this.getFormData(n),c=r.formData,d=r.formContent,u=r.formAction,f=s.html();return s.html(d),o.removeClass("is-editing fade-in-full").addClass("being-posted fade-in-half"),o.find(".note-headline-meta a").html('<span class="spinner align-text-bottom"></span>'),g.a.post("".concat(u,"?html=true"),c).then((function(e){var n=e.data;t.updateNote(n,o)})).catch((function(){s.html(a()(f)),o.removeClass("being-posted fade-in"),o.find(".spinner").remove(),t.updateNoteError()})),i.text(i.data("originalText"))}}],[{key:"initCommentTypeToggle",value:function(e){var t=e.querySelector(".js-comment-type-dropdown .dropdown-toggle"),n=e.querySelector(".js-comment-type-dropdown .dropdown-menu"),i=e.querySelector("#note_type"),o=e.querySelector(".js-comment-type-dropdown .js-comment-submit-button"),s=e.querySelector(".js-note-target-close"),a=e.querySelector(".js-note-target-reopen");new E({dropdownTrigger:t,dropdownList:n,noteTypeInput:i,submitButton:o,closeButton:s,reopenButton:a}).initDroplab()}},{key:"updateNoteTargetSelector",value:function(e){var t=Object(y.e)(),n=Boolean(t&&e.filter("#".concat(t)).length>0);e.toggleClass("target",n)}},{key:"renderPlaceholderComponent",value:function(e){var t=e.find(".js-code-placeholder").get(0);new h.default({el:t,components:{GlSkeletonLoading:m.a},render:function(e){return e("gl-skeleton-loading")}})}},{key:"renderDiffContent",value:function(e,t){var n=t.discussion_html,i=l()(n).find(".line_holder");i.addClass("fade-in"),e.find(".diff-content > table > tbody").prepend(i);var o=e.find(".file-holder");e.find(".line-holder-placeholder").remove(),Object(v.a)(o)}},{key:"isNewNote",value:function(e,t){return-1===l.a.inArray(e.id,t)}},{key:"isUpdatedNote",value:function(e,t){return B(e.note.trim())!==B(t.find(".original-note-content").first().text().trim())}},{key:"checkMergeRequestStatus",value:function(){"merge_requests"===Object(D.n)(1)&&gl.mrWidget&&gl.mrWidget.checkStatus()}},{key:"animateAppendNote",value:function(e,t){var n=l()(e);return n.addClass("fade-in-full").renderGFM(),t.append(n),n}},{key:"animateUpdateNote",value:function(e,t){var n=l()(e);return n.addClass("fade-in").renderGFM(),t.replaceWith(n),n}}]),e}();window.Notes=M}}]);
//# sourceMappingURL=commons~pages.projects.commit.show~pages.projects.merge_requests.creations.new~pages.projects.merge_~d192d954.aa80e44d.chunk.js.map